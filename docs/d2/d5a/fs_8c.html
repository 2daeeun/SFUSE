<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SFUSE_Documentation: src/fs.c 파일 참조</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SFUSE_Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 다음에 의해 생성됨 :  Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','검색',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('d2/d5a/fs_8c.html','../../',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">로딩중...</div>
<div class="SRStatus" id="Searching">검색중...</div>
<div class="SRStatus" id="NoMatches">일치하는것 없음</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">fs.c 파일 참조</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../df/d26/fs_8h_source.html">fs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../da/dcb/bitmap_8h_source.html">bitmap.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../de/d40/block_8h_source.html">block.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../df/d9c/dir_8h_source.html">dir.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d73/inode_8h_source.html">inode.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d98/super_8h_source.html">super.h</a>&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fuse3/fuse.h&gt;</code><br />
<code>#include &lt;linux/fs.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/ioctl.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
fs.c에 대한 include 의존 그래프</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d4f/fs_8c__incl.png" border="0" usemap="#asrc_2fs_8c" loading="lazy" alt=""/></div>
<map name="asrc_2fs_8c" id="asrc_2fs_8c">
<area shape="rect" title=" " alt="" coords="548,5,615,33"/>
<area shape="rect" href="../../df/d26/fs_8h.html" title=" " alt="" coords="321,157,367,184"/>
<area shape="poly" title=" " alt="" coords="548,26,512,31,470,42,428,59,390,83,368,111,354,143,349,141,363,109,386,79,425,54,468,37,511,26,547,21"/>
<area shape="rect" href="../../db/d98/super_8h.html" title=" " alt="" coords="63,232,132,260"/>
<area shape="poly" title=" " alt="" coords="548,26,426,37,263,62,183,79,111,101,55,127,35,142,21,158,17,175,24,192,40,208,59,222,56,226,36,212,20,195,12,176,16,155,31,138,52,123,109,96,181,74,262,56,425,32,547,20"/>
<area shape="rect" title=" " alt="" coords="98,308,169,336"/>
<area shape="poly" title=" " alt="" coords="547,24,444,30,308,40,176,58,122,69,83,83,49,102,24,123,10,149,11,184,21,224,42,258,66,281,93,298,90,303,63,285,38,262,16,226,5,185,5,148,20,120,46,98,80,79,120,64,175,52,308,35,444,24,547,19"/>
<area shape="rect" title=" " alt="" coords="428,232,529,260"/>
<area shape="poly" title=" " alt="" coords="578,34,494,219,489,217,573,32"/>
<area shape="rect" title=" " alt="" coords="554,232,638,260"/>
<area shape="poly" title=" " alt="" coords="584,33,591,184,595,217,589,217,585,185,579,33"/>
<area shape="rect" title=" " alt="" coords="662,232,725,260"/>
<area shape="poly" title=" " alt="" coords="590,32,683,217,678,220,585,34"/>
<area shape="rect" href="../../da/dcb/bitmap_8h.html" title=" " alt="" coords="31,157,110,184"/>
<area shape="poly" title=" " alt="" coords="548,27,419,45,338,62,258,84,177,116,108,151,106,146,174,111,257,78,337,56,418,40,547,21"/>
<area shape="rect" href="../../de/d40/block_8h.html" title=" " alt="" coords="229,157,297,184"/>
<area shape="poly" title=" " alt="" coords="548,28,461,46,411,62,363,83,320,114,286,147,282,143,316,110,360,79,409,57,460,41,547,22"/>
<area shape="rect" href="../../df/d9c/dir_8h.html" title=" " alt="" coords="400,81,451,109"/>
<area shape="poly" title=" " alt="" coords="555,36,466,78,463,73,552,31"/>
<area shape="rect" href="../../d3/d73/inode_8h.html" title=" " alt="" coords="135,157,204,184"/>
<area shape="poly" title=" " alt="" coords="548,27,444,46,380,62,318,83,254,116,201,150,198,145,252,111,316,79,379,57,442,41,547,22"/>
<area shape="rect" title=" " alt="" coords="644,81,711,109"/>
<area shape="poly" title=" " alt="" coords="600,31,650,69,647,73,597,36"/>
<area shape="rect" title=" " alt="" coords="735,81,817,109"/>
<area shape="poly" title=" " alt="" coords="616,31,728,73,726,78,614,36"/>
<area shape="rect" title=" " alt="" coords="841,81,922,109"/>
<area shape="poly" title=" " alt="" coords="616,26,826,77,825,83,615,31"/>
<area shape="rect" title=" " alt="" coords="946,81,1011,109"/>
<area shape="poly" title=" " alt="" coords="616,22,750,43,931,78,930,83,749,48,615,28"/>
<area shape="rect" title=" " alt="" coords="1036,81,1105,109"/>
<area shape="poly" title=" " alt="" coords="616,21,786,40,901,57,1021,78,1020,83,900,62,786,46,615,26"/>
<area shape="rect" title=" " alt="" coords="1129,81,1199,109"/>
<area shape="poly" title=" " alt="" coords="616,20,823,37,966,55,1114,78,1114,83,965,60,822,43,615,25"/>
<area shape="rect" title=" " alt="" coords="1223,81,1310,109"/>
<area shape="poly" title=" " alt="" coords="616,20,859,37,1030,54,1208,78,1208,83,1029,60,859,43,616,25"/>
<area shape="rect" title=" " alt="" coords="1334,81,1407,109"/>
<area shape="poly" title=" " alt="" coords="616,19,731,22,902,32,1107,50,1319,78,1319,83,1106,55,902,37,730,28,616,24"/>
<area shape="poly" title=" " alt="" coords="322,183,310,187,148,234,146,229,309,182,320,178"/>
<area shape="poly" title=" " alt="" coords="368,182,443,222,440,227,366,187"/>
<area shape="poly" title=" " alt="" coords="368,176,540,226,538,231,367,181"/>
<area shape="rect" title=" " alt="" coords="258,232,353,260"/>
<area shape="poly" title=" " alt="" coords="340,186,322,220,317,217,335,184"/>
<area shape="poly" title=" " alt="" coords="368,173,484,194,647,229,646,234,483,199,367,178"/>
<area shape="poly" title=" " alt="" coords="106,259,123,293,118,295,102,262"/>
<area shape="poly" title=" " alt="" coords="78,184,90,217,85,219,73,186"/>
<area shape="poly" title=" " alt="" coords="65,185,51,220,49,240,53,259,70,281,92,298,89,302,66,284,48,261,43,240,46,219,60,183"/>
<area shape="poly" title=" " alt="" coords="254,186,157,298,153,294,250,183"/>
<area shape="poly" title=" " alt="" coords="273,184,293,218,288,220,268,186"/>
<area shape="poly" title=" " alt="" coords="413,111,371,148,368,144,409,107"/>
<area shape="poly" title=" " alt="" coords="427,109,423,140,414,181,396,225,383,245,367,262,325,290,276,309,228,319,185,323,184,318,227,313,275,304,322,286,364,258,379,241,391,222,409,180,418,139,422,109"/>
<area shape="poly" title=" " alt="" coords="433,108,471,216,466,218,428,110"/>
<area shape="poly" title=" " alt="" coords="158,187,123,223,119,219,155,183"/>
<area shape="poly" title=" " alt="" coords="169,185,143,293,138,292,164,184"/>
</map>
</div>
</div>
<p><a href="../../d2/d5a/fs_8c_source.html">이 파일의 소스 코드 페이지로 가기</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
함수</h2></td></tr>
<tr class="memitem:a36d02c17ab05553ae865cae9f1c85abc" id="r_a36d02c17ab05553ae865cae9f1c85abc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36d02c17ab05553ae865cae9f1c85abc">fs_format_filesystem</a> (int fd, struct <a class="el" href="../../d7/d75/structsfuse__superblock.html">sfuse_superblock</a> *sb)</td></tr>
<tr class="memdesc:a36d02c17ab05553ae865cae9f1c85abc"><td class="mdescLeft">&#160;</td><td class="mdescRight">빈 이미지 파일을 VSFS 구조로 포맷  <br /></td></tr>
<tr class="memitem:a2647416442bb14c576015d7afa69ac81" id="r_a2647416442bb14c576015d7afa69ac81"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2647416442bb14c576015d7afa69ac81">fs_initialize</a> (const char *path, int *error_out)</td></tr>
<tr class="memdesc:a2647416442bb14c576015d7afa69ac81"><td class="mdescLeft">&#160;</td><td class="mdescRight">SFUSE FS 초기화  <br /></td></tr>
<tr class="memitem:a2bc3c75472b51af52b6e3bf1e4f17667" id="r_a2bc3c75472b51af52b6e3bf1e4f17667"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2bc3c75472b51af52b6e3bf1e4f17667">fs_teardown</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs)</td></tr>
<tr class="memdesc:a2bc3c75472b51af52b6e3bf1e4f17667"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 시스템 해제  <br /></td></tr>
<tr class="memitem:a8d5826ede78fcd2b76628eabb56e70db" id="r_a8d5826ede78fcd2b76628eabb56e70db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, uint32_t *out_ino)</td></tr>
<tr class="memdesc:a8d5826ede78fcd2b76628eabb56e70db"><td class="mdescLeft">&#160;</td><td class="mdescRight">경로 문자열을 inode 번호로 변환  <br /></td></tr>
<tr class="memitem:a012d00e6eafc0bb7c9402e3f36cee00a" id="r_a012d00e6eafc0bb7c9402e3f36cee00a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a012d00e6eafc0bb7c9402e3f36cee00a">fs_getattr</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, struct stat *stbuf)</td></tr>
<tr class="memdesc:a012d00e6eafc0bb7c9402e3f36cee00a"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 또는 디렉터리 속성 가져오기 (stat)  <br /></td></tr>
<tr class="memitem:addbb0f0d2e2d634975c40330e23bc8ae" id="r_addbb0f0d2e2d634975c40330e23bc8ae"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#addbb0f0d2e2d634975c40330e23bc8ae">fs_readdir</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, void *buf, fuse_fill_dir_t filler, off_t offset)</td></tr>
<tr class="memdesc:addbb0f0d2e2d634975c40330e23bc8ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">디렉터리 목록 가져오기  <br /></td></tr>
<tr class="memitem:a9741976c80c2167280c9a0c3ff856d2d" id="r_a9741976c80c2167280c9a0c3ff856d2d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9741976c80c2167280c9a0c3ff856d2d">fs_open</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, struct fuse_file_info *fi)</td></tr>
<tr class="memdesc:a9741976c80c2167280c9a0c3ff856d2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 열기 (존재 여부만 확인)  <br /></td></tr>
<tr class="memitem:a28b88e33bc2ea2e1f024968f35073824" id="r_a28b88e33bc2ea2e1f024968f35073824"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a28b88e33bc2ea2e1f024968f35073824">fs_read</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, char *buf, size_t size, off_t offset)</td></tr>
<tr class="memdesc:a28b88e33bc2ea2e1f024968f35073824"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 읽기  <br /></td></tr>
<tr class="memitem:aecadaa463253df28c47f4a201dda2359" id="r_aecadaa463253df28c47f4a201dda2359"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aecadaa463253df28c47f4a201dda2359">fs_write</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, const char *buf, size_t size, off_t offset)</td></tr>
<tr class="memdesc:aecadaa463253df28c47f4a201dda2359"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 쓰기  <br /></td></tr>
<tr class="memitem:a6129288ed91728ed7ef053ad8d0cc79d" id="r_a6129288ed91728ed7ef053ad8d0cc79d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6129288ed91728ed7ef053ad8d0cc79d">fs_create</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, mode_t mode, struct fuse_file_info *fi)</td></tr>
<tr class="memdesc:a6129288ed91728ed7ef053ad8d0cc79d"><td class="mdescLeft">&#160;</td><td class="mdescRight">새 파일 생성  <br /></td></tr>
<tr class="memitem:a0e6c18058ed432a1b33962e1f7fda11f" id="r_a0e6c18058ed432a1b33962e1f7fda11f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0e6c18058ed432a1b33962e1f7fda11f">fs_mkdir</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, mode_t mode)</td></tr>
<tr class="memdesc:a0e6c18058ed432a1b33962e1f7fda11f"><td class="mdescLeft">&#160;</td><td class="mdescRight">새 디렉터리 생성  <br /></td></tr>
<tr class="memitem:add11b7953b7d14deb0456e14c8d7b197" id="r_add11b7953b7d14deb0456e14c8d7b197"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#add11b7953b7d14deb0456e14c8d7b197">fs_unlink</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path)</td></tr>
<tr class="memdesc:add11b7953b7d14deb0456e14c8d7b197"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 삭제  <br /></td></tr>
<tr class="memitem:a8cf3ec78e9108f22f73ac3ab974fe8dc" id="r_a8cf3ec78e9108f22f73ac3ab974fe8dc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cf3ec78e9108f22f73ac3ab974fe8dc">fs_rmdir</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path)</td></tr>
<tr class="memdesc:a8cf3ec78e9108f22f73ac3ab974fe8dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">비어 있는 디렉터리 삭제  <br /></td></tr>
<tr class="memitem:af677d22449626003a22868b28501f79a" id="r_af677d22449626003a22868b28501f79a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af677d22449626003a22868b28501f79a">fs_rename</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *from, const char *to)</td></tr>
<tr class="memdesc:af677d22449626003a22868b28501f79a"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 또는 디렉터리 이름 변경 (이동)  <br /></td></tr>
<tr class="memitem:a6a7f3ad04cc17f3fb58519236a2ee996" id="r_a6a7f3ad04cc17f3fb58519236a2ee996"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6a7f3ad04cc17f3fb58519236a2ee996">fs_truncate</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, off_t size)</td></tr>
<tr class="memdesc:a6a7f3ad04cc17f3fb58519236a2ee996"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 크기 조정  <br /></td></tr>
<tr class="memitem:ab503c5dc5cb6a0dc77f0b6d92bfccf5f" id="r_ab503c5dc5cb6a0dc77f0b6d92bfccf5f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab503c5dc5cb6a0dc77f0b6d92bfccf5f">fs_fsync</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, int datasync, struct fuse_file_info *fi)</td></tr>
<tr class="memdesc:ab503c5dc5cb6a0dc77f0b6d92bfccf5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 시스템 동기화 (flush/fsync)  <br /></td></tr>
<tr class="memitem:afa59764091da583a569ad9e517043425" id="r_afa59764091da583a569ad9e517043425"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afa59764091da583a569ad9e517043425">fs_flush</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, struct fuse_file_info *fi)</td></tr>
<tr class="memdesc:afa59764091da583a569ad9e517043425"><td class="mdescLeft">&#160;</td><td class="mdescRight">FUSE의 flush 호출 처리  <br /></td></tr>
<tr class="memitem:a818f99fae8ad5abcc450d41aac5d37ec" id="r_a818f99fae8ad5abcc450d41aac5d37ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a818f99fae8ad5abcc450d41aac5d37ec">fs_utimens</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, const struct timespec tv[2])</td></tr>
<tr class="memdesc:a818f99fae8ad5abcc450d41aac5d37ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 접근/수정 시간 업데이트  <br /></td></tr>
<tr class="memitem:ae8816ea1bc016bed838b45345615d46c" id="r_ae8816ea1bc016bed838b45345615d46c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae8816ea1bc016bed838b45345615d46c">fs_access</a> (struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *fs, const char *path, int mask)</td></tr>
<tr class="memdesc:ae8816ea1bc016bed838b45345615d46c"><td class="mdescLeft">&#160;</td><td class="mdescRight">파일 접근 권한 검사  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
변수</h2></td></tr>
<tr class="memitem:a0771760ee8a223b01c598e70420cef0c" id="r_a0771760ee8a223b01c598e70420cef0c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0771760ee8a223b01c598e70420cef0c">g_force_format</a></td></tr>
<tr class="memdesc:a0771760ee8a223b01c598e70420cef0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">전역: 포맷 강제 여부 (-F 옵션)  <br /></td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">함수 문서화</h2>
<a id="ae8816ea1bc016bed838b45345615d46c" name="ae8816ea1bc016bed838b45345615d46c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8816ea1bc016bed838b45345615d46c">&#9670;&#160;</a></span>fs_access()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_access </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>mask</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 접근 권한 검사 </p>
<p>접근 권한 검사</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>검사할 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">mask</td><td>접근 마스크 (R_OK, W_OK, X_OK) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01343">1343</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1343</span>                                                               {</div>
<div class="line"><span class="lineno"> 1344</span>  uint32_t ino;</div>
<div class="line"><span class="lineno"> 1345</span>  <span class="comment">/* 경로 → inode 변환 실패 시 ENOENT 반환 */</span></div>
<div class="line"><span class="lineno"> 1346</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0)</div>
<div class="line"><span class="lineno"> 1347</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno"> 1348</span>  <span class="comment">/* mask에 따른 실제 권한 검사는 필요 시 구현 가능 */</span></div>
<div class="line"><span class="lineno"> 1349</span>  (void)mask;</div>
<div class="line"><span class="lineno"> 1350</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1351</span>}</div>
<div class="ttc" id="afs_8c_html_a8d5826ede78fcd2b76628eabb56e70db"><div class="ttname"><a href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a></div><div class="ttdeci">int fs_resolve_path(struct sfuse_fs *fs, const char *path, uint32_t *out_ino)</div><div class="ttdoc">경로 문자열을 inode 번호로 변환</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d5a/fs_8c_source.html#l00198">fs.c:198</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_cgraph" id="ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_cgraph">
<area shape="rect" title="파일 접근 권한 검사" alt="" coords="5,32,90,60"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="138,32,262,60"/>
<area shape="poly" title=" " alt="" coords="90,43,122,43,122,48,90,48"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="310,32,399,60"/>
<area shape="poly" title=" " alt="" coords="263,43,294,43,294,48,263,48"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="447,5,540,33"/>
<area shape="poly" title=" " alt="" coords="399,35,431,28,433,34,400,40"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="447,57,540,85"/>
<area shape="poly" title=" " alt="" coords="400,51,432,57,432,63,399,57"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="588,5,690,33"/>
<area shape="poly" title=" " alt="" coords="540,16,572,16,572,22,540,22"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_icgraph" id="ad2/d5a/fs_8c_ae8816ea1bc016bed838b45345615d46c_icgraph">
<area shape="rect" title="파일 접근 권한 검사" alt="" coords="493,5,578,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acf365c5992fb91ebb3982a04fbbdf3b4" title="access 콜백" alt="" coords="316,5,445,33"/>
<area shape="poly" title=" " alt="" coords="478,22,446,22,446,16,478,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a6129288ed91728ed7ef053ad8d0cc79d" name="a6129288ed91728ed7ef053ad8d0cc79d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6129288ed91728ed7ef053ad8d0cc79d">&#9670;&#160;</a></span>fs_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t</td>          <td class="paramname"><span class="paramname"><em>mode</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct fuse_file_info *</td>          <td class="paramname"><span class="paramname"><em>fi</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>새 파일 생성 </p>
<p>파일 생성</p>
<p>지정된 경로에 새 파일을 생성하고 상위 디렉터리에 디렉터리 엔트리를 추가한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>생성할 파일 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">mode</td><td>파일 모드 및 권한 (하위 12비트 사용) </td></tr>
    <tr><td class="paramname">fi</td><td>FUSE 파일 정보 구조체 (사용되지 않음) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 일반 파일로 설정</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00570">570</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  571</span>                                         {</div>
<div class="line"><span class="lineno">  572</span>  (void)fi;</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>  uint32_t dummy;</div>
<div class="line"><span class="lineno">  575</span>  <span class="comment">/* 이미 존재하면 실패 */</span></div>
<div class="line"><span class="lineno">  576</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;dummy) == 0) {</div>
<div class="line"><span class="lineno">  577</span>    <span class="keywordflow">return</span> -EEXIST;</div>
<div class="line"><span class="lineno">  578</span>  }</div>
<div class="line"><span class="lineno">  579</span> </div>
<div class="line"><span class="lineno">  580</span>  <span class="comment">/* 상위 디렉터리와 새 파일 이름 분리 */</span></div>
<div class="line"><span class="lineno">  581</span>  <span class="keywordtype">char</span> *path_copy = strdup(path);</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordflow">if</span> (!path_copy)</div>
<div class="line"><span class="lineno">  583</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno">  584</span>  <span class="keywordtype">char</span> *name = strrchr(path_copy, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  585</span>  <span class="keywordflow">if</span> (!name || *(name + 1) == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">  586</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  587</span>    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><span class="lineno">  588</span>  }</div>
<div class="line"><span class="lineno">  589</span>  *name = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  590</span>  <span class="keywordtype">char</span> *parent_path = (*path_copy == <span class="charliteral">&#39;\0&#39;</span>) ? <span class="stringliteral">&quot;/&quot;</span> : path_copy;</div>
<div class="line"><span class="lineno">  591</span>  name++;</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>  <span class="comment">/* 상위 디렉터리 inode 찾기 */</span></div>
<div class="line"><span class="lineno">  594</span>  uint32_t parent_ino;</div>
<div class="line"><span class="lineno">  595</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, parent_path, &amp;parent_ino) &lt; 0) {</div>
<div class="line"><span class="lineno">  596</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  597</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  598</span>  }</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> parent_inode;</div>
<div class="line"><span class="lineno">  601</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  602</span>  <span class="comment">/* 상위가 디렉터리인지 확인 */</span></div>
<div class="line"><span class="lineno">  603</span>  <span class="keywordflow">if</span> ((parent_inode.mode &amp; S_IFDIR) == 0) {</div>
<div class="line"><span class="lineno">  604</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  605</span>    <span class="keywordflow">return</span> -ENOTDIR;</div>
<div class="line"><span class="lineno">  606</span>  }</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>  <span class="comment">/* 새 아이노드 할당 */</span></div>
<div class="line"><span class="lineno">  609</span>  <span class="keywordtype">int</span> new_ino = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a08b712b2489ab7b3346f82316300c6b3">alloc_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>);</div>
<div class="line"><span class="lineno">  610</span>  <span class="keywordflow">if</span> (new_ino &lt; 0) {</div>
<div class="line"><span class="lineno">  611</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">return</span> new_ino;</div>
<div class="line"><span class="lineno">  613</span>  }</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>  <span class="comment">/* 새 아이노드 초기화 */</span></div>
<div class="line"><span class="lineno">  616</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> new_inode;</div>
<div class="line"><span class="lineno">  617</span>  memset(&amp;new_inode, 0, <span class="keyword">sizeof</span>(new_inode));</div>
<div class="line"><span class="lineno">  618</span>  new_inode.mode = (<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a399b204af355418f3faa7cde72389973">mode</a> &amp; 0xFFF) | S_IFREG; </div>
<div class="line"><span class="lineno">  619</span>  new_inode.uid = getuid();</div>
<div class="line"><span class="lineno">  620</span>  new_inode.gid = getgid();</div>
<div class="line"><span class="lineno">  621</span>  new_inode.size = 0;</div>
<div class="line"><span class="lineno">  622</span>  time_t now = time(NULL);</div>
<div class="line"><span class="lineno">  623</span>  new_inode.atime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  624</span>  new_inode.mtime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  625</span>  new_inode.ctime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>  <span class="comment">/* 상위 디렉터리에 엔트리 추가 */</span></div>
<div class="line"><span class="lineno">  628</span>  uint8_t dir_block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  629</span>  <span class="keywordtype">bool</span> added = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  630</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 12 &amp;&amp; !added; ++i) {</div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">if</span> (parent_inode.direct[i] == 0) {</div>
<div class="line"><span class="lineno">  632</span>      <span class="comment">/* 새 디렉터리 블록 할당 및 초기화 */</span></div>
<div class="line"><span class="lineno">  633</span>      <span class="keywordtype">int</span> new_dir_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  634</span>      <span class="keywordflow">if</span> (new_dir_block &lt; 0) {</div>
<div class="line"><span class="lineno">  635</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  636</span>        free(path_copy);</div>
<div class="line"><span class="lineno">  637</span>        <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  638</span>      }</div>
<div class="line"><span class="lineno">  639</span>      parent_inode.direct[i] =</div>
<div class="line"><span class="lineno">  640</span>          fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> + (uint32_t)new_dir_block;</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>      memset(dir_block, 0, <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno">  643</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)dir_block;</div>
<div class="line"><span class="lineno">  644</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = new_ino;</div>
<div class="line"><span class="lineno">  645</span>      strncpy(entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno">  646</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[<a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block);</div>
<div class="line"><span class="lineno">  649</span>      parent_inode.size += <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno">  650</span>      added = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  651</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  652</span>      <span class="comment">/* 기존 블록에서 빈 슬롯 검색 */</span></div>
<div class="line"><span class="lineno">  653</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block) &lt; 0) {</div>
<div class="line"><span class="lineno">  654</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  655</span>        free(path_copy);</div>
<div class="line"><span class="lineno">  656</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  657</span>      }</div>
<div class="line"><span class="lineno">  658</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)dir_block;</div>
<div class="line"><span class="lineno">  659</span>      <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno">  660</span>        <span class="keywordflow">if</span> (entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> == 0) {</div>
<div class="line"><span class="lineno">  661</span>          entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = new_ino;</div>
<div class="line"><span class="lineno">  662</span>          strncpy(entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno">  663</span>          entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[<a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  664</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block);</div>
<div class="line"><span class="lineno">  665</span>          added = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  666</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  667</span>        }</div>
<div class="line"><span class="lineno">  668</span>      }</div>
<div class="line"><span class="lineno">  669</span>    }</div>
<div class="line"><span class="lineno">  670</span>  }</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>  <span class="keywordflow">if</span> (!added) {</div>
<div class="line"><span class="lineno">  673</span>    <span class="comment">/* 공간 부족 시 롤백 */</span></div>
<div class="line"><span class="lineno">  674</span>    <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  675</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  676</span>    <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  677</span>  }</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>  <span class="comment">/* 새 아이노드를 디스크에 기록 */</span></div>
<div class="line"><span class="lineno">  680</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, new_ino, &amp;new_inode);</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>  <span class="comment">/* 상위 디렉터리 메타데이터 갱신 */</span></div>
<div class="line"><span class="lineno">  683</span>  parent_inode.mtime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  684</span>  parent_inode.ctime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  685</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>  free(path_copy);</div>
<div class="line"><span class="lineno">  688</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  689</span>}</div>
<div class="ttc" id="abitmap_8h_html_a08b712b2489ab7b3346f82316300c6b3"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html#a08b712b2489ab7b3346f82316300c6b3">alloc_inode</a></div><div class="ttdeci">int alloc_inode(struct sfuse_superblock *sb, struct sfuse_inode_bitmap *imap)</div><div class="ttdoc">슈퍼블록 기반으로 아이노드 할당</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9a/bitmap_8c_source.html#l00095">bitmap.c:95</a></div></div>
<div class="ttc" id="abitmap_8h_html_a156ed842116a648997c737d182b7416a"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a></div><div class="ttdeci">void free_inode(struct sfuse_superblock *sb, struct sfuse_inode_bitmap *imap, uint32_t ino)</div><div class="ttdoc">슈퍼블록 기반으로 아이노드 해제</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9a/bitmap_8c_source.html#l00109">bitmap.c:109</a></div></div>
<div class="ttc" id="abitmap_8h_html_a7342a6b6280af158749416ff1fffadfc"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a></div><div class="ttdeci">int alloc_block(struct sfuse_superblock *sb, struct sfuse_block_bitmap *bmap)</div><div class="ttdoc">슈퍼블록 기반으로 데이터 블록 할당</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9a/bitmap_8c_source.html#l00121">bitmap.c:121</a></div></div>
<div class="ttc" id="ablock_8h_html_a737beb05c598c11278e8b17146b48dcf"><div class="ttname"><a href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a></div><div class="ttdeci">ssize_t read_block(int fd, uint32_t blk, void *out_buf)</div><div class="ttdoc">지정한 블록 번호의 데이터를 읽어 버퍼에 저장</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d1c/block_8c_source.html#l00015">block.c:15</a></div></div>
<div class="ttc" id="ablock_8h_html_af4beb38783113f42a845b7702ebaa8d5"><div class="ttname"><a href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a></div><div class="ttdeci">ssize_t write_block(int fd, uint32_t blk, const void *buf)</div><div class="ttdoc">버퍼의 내용을 지정한 블록 번호에 기록</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d1c/block_8c_source.html#l00031">block.c:31</a></div></div>
<div class="ttc" id="adir_8h_html_a309b8658c2817a5c55a08445e9760743"><div class="ttname"><a href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a></div><div class="ttdeci">#define SFUSE_NAME_MAX</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9c/dir_8h_source.html#l00010">dir.h:10</a></div></div>
<div class="ttc" id="adir_8h_html_aea073931da657513026982c1aac99b4d"><div class="ttname"><a href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a></div><div class="ttdeci">#define DENTS_PER_BLOCK</div><div class="ttdoc">한 블록당 디렉터리 엔트리 수</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9c/dir_8h_source.html#l00014">dir.h:14</a></div></div>
<div class="ttc" id="ainode_8h_html_a490b41738be882c224282cb0873c4185"><div class="ttname"><a href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a></div><div class="ttdeci">int inode_load(int fd, const struct sfuse_superblock *sb, uint32_t ino, struct sfuse_inode *out)</div><div class="ttdoc">디스크 이미지에서 아이노드를 읽어 구조체에 로드</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d2b/inode_8c_source.html#l00032">inode.c:32</a></div></div>
<div class="ttc" id="ainode_8h_html_abbb03a523d329cec86d9473e1a6ff70b"><div class="ttname"><a href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a></div><div class="ttdeci">int inode_sync(int fd, const struct sfuse_superblock *sb, uint32_t ino, const struct sfuse_inode *in)</div><div class="ttdoc">아이노드 구조체 내용을 디스크 이미지에 동기화</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d2b/inode_8c_source.html#l00051">inode.c:51</a></div></div>
<div class="ttc" id="astructsfuse__bitmaps_html_a9b626055d1a1c2f76698bd9723f0110f"><div class="ttname"><a href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">sfuse_bitmaps::block</a></div><div class="ttdeci">struct sfuse_block_bitmap block</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcb/bitmap_8h_source.html#l00032">bitmap.h:32</a></div></div>
<div class="ttc" id="astructsfuse__bitmaps_html_ae875a8ba6b9ca19192fc23bef93c8adf"><div class="ttname"><a href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">sfuse_bitmaps::inode</a></div><div class="ttdeci">struct sfuse_inode_bitmap inode</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcb/bitmap_8h_source.html#l00031">bitmap.h:31</a></div></div>
<div class="ttc" id="astructsfuse__dirent_html"><div class="ttname"><a href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a></div><div class="ttdoc">디스크에 저장되는 디렉터리 엔트리 구조체</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9c/dir_8h_source.html#l00019">dir.h:19</a></div></div>
<div class="ttc" id="astructsfuse__dirent_html_a73e74a2f27bfdd1383b6292beff30476"><div class="ttname"><a href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">sfuse_dirent::inode</a></div><div class="ttdeci">uint32_t inode</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9c/dir_8h_source.html#l00020">dir.h:20</a></div></div>
<div class="ttc" id="astructsfuse__dirent_html_a9b38e50447844882ddaaacb947f3d5dc"><div class="ttname"><a href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">sfuse_dirent::name</a></div><div class="ttdeci">char name[256]</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9c/dir_8h_source.html#l00021">dir.h:21</a></div></div>
<div class="ttc" id="astructsfuse__fs_html_a188eaee1b599d1c0260a905a1c27c73d"><div class="ttname"><a href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">sfuse_fs::bmaps</a></div><div class="ttdeci">struct sfuse_bitmaps * bmaps</div><div class="ttdef"><b>Definition</b> <a href="../../df/d26/fs_8h_source.html#l00024">fs.h:24</a></div></div>
<div class="ttc" id="astructsfuse__fs_html_a86cd2ebfda2408f59d3260897c1a4866"><div class="ttname"><a href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sfuse_fs::sb</a></div><div class="ttdeci">struct sfuse_superblock sb</div><div class="ttdef"><b>Definition</b> <a href="../../df/d26/fs_8h_source.html#l00023">fs.h:23</a></div></div>
<div class="ttc" id="astructsfuse__fs_html_af14cab3f6994b0e91e858ddffc424140"><div class="ttname"><a href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">sfuse_fs::backing_fd</a></div><div class="ttdeci">int backing_fd</div><div class="ttdef"><b>Definition</b> <a href="../../df/d26/fs_8h_source.html#l00022">fs.h:22</a></div></div>
<div class="ttc" id="astructsfuse__inode_html"><div class="ttname"><a href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a></div><div class="ttdoc">디스크에 저장되는 아이노드 구조체</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d73/inode_8h_source.html#l00022">inode.h:22</a></div></div>
<div class="ttc" id="astructsfuse__inode_html_a399b204af355418f3faa7cde72389973"><div class="ttname"><a href="../../d2/d13/structsfuse__inode.html#a399b204af355418f3faa7cde72389973">sfuse_inode::mode</a></div><div class="ttdeci">uint32_t mode</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d73/inode_8h_source.html#l00023">inode.h:23</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a85add9a4b064a3a048d7580e1ecd9a85"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">sfuse_superblock::data_block_start</a></div><div class="ttdeci">uint32_t data_block_start</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00060">super.h:60</a></div></div>
<div class="ttc" id="asuper_8h_html_a0f31825083a6f1e0e2f5b5a2fd1181aa"><div class="ttname"><a href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a></div><div class="ttdeci">#define SFUSE_BLOCK_SIZE</div><div class="ttdoc">블록 크기 (바이트 단위)</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00020">super.h:20</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_cgraph" id="ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_cgraph">
<area shape="rect" title="새 파일 생성" alt="" coords="5,185,87,213"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a7342a6b6280af158749416ff1fffadfc" title="슈퍼블록 기반으로 데이터 블록 할당" alt="" coords="150,5,244,33"/>
<area shape="poly" title=" " alt="" coords="50,184,78,118,102,79,133,44,138,39,142,44,137,48,106,82,83,121,54,186"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a08b712b2489ab7b3346f82316300c6b3" title="슈퍼블록 기반으로 아이노드 할당" alt="" coords="149,57,244,85"/>
<area shape="poly" title=" " alt="" coords="54,183,86,141,108,117,133,96,141,91,144,95,136,100,112,121,90,145,59,187"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a156ed842116a648997c737d182b7416a" title="슈퍼블록 기반으로 아이노드 해제" alt="" coords="152,109,242,137"/>
<area shape="poly" title=" " alt="" coords="74,182,153,142,155,147,77,187"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="135,261,259,289"/>
<area shape="poly" title=" " alt="" coords="77,211,155,251,153,256,74,216"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="445,264,538,292"/>
<area shape="poly" title=" " alt="" coords="57,212,86,257,109,280,136,298,174,312,213,319,254,322,295,321,371,310,435,294,436,299,372,315,295,326,254,328,213,325,172,317,133,303,106,285,82,261,52,215"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="445,212,538,240"/>
<area shape="poly" title=" " alt="" coords="87,199,430,220,430,225,87,204"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="444,160,539,188"/>
<area shape="poly" title=" " alt="" coords="87,194,428,175,429,180,87,200"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="149,363,245,390"/>
<area shape="poly" title=" " alt="" coords="55,212,85,273,108,310,137,343,149,352,146,357,133,346,104,313,80,276,50,214"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad195af185232b43149a1d9442e28d077" title="비트맵에서 0인 비트를 찾아 1로 설정하고 인덱스를 반환" alt="" coords="314,32,390,60"/>
<area shape="poly" title=" " alt="" coords="245,25,299,34,298,39,244,30"/>
<area shape="poly" title=" " alt="" coords="245,61,297,52,298,57,246,66"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a9d97a51ca0096c6fe7bf18c3947d2abb" title="비트맵에서 지정한 인덱스 비트를 0으로 설정" alt="" coords="316,109,387,137"/>
<area shape="poly" title=" " alt="" coords="243,120,301,120,301,126,243,126"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="307,261,396,289"/>
<area shape="poly" title=" " alt="" coords="260,272,291,272,291,278,260,278"/>
<area shape="poly" title=" " alt="" coords="397,273,430,274,430,279,397,279"/>
<area shape="poly" title=" " alt="" coords="392,258,435,243,437,248,394,263"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="587,212,689,240"/>
<area shape="poly" title=" " alt="" coords="532,261,582,243,584,248,534,266"/>
<area shape="poly" title=" " alt="" coords="534,186,584,204,582,209,532,191"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_icgraph" id="ad2/d5a/fs_8c_a6129288ed91728ed7ef053ad8d0cc79d_icgraph">
<area shape="rect" title="새 파일 생성" alt="" coords="490,5,572,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6dc52b86f2cef1906558a324213cac6e" title="파일 생성 콜백" alt="" coords="316,5,442,33"/>
<area shape="poly" title=" " alt="" coords="474,22,443,22,443,16,474,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,269,22,269,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="afa59764091da583a569ad9e517043425" name="afa59764091da583a569ad9e517043425"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa59764091da583a569ad9e517043425">&#9670;&#160;</a></span>fs_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_flush </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct fuse_file_info *</td>          <td class="paramname"><span class="paramname"><em>fi</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FUSE의 flush 호출 처리 </p>
<p>FUSE에서 플러시 요청 처리</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>대상 경로 (사용되지 않음) </td></tr>
    <tr><td class="paramname">fi</td><td>FUSE 파일 정보 구조체 (사용되지 않음) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01302">1302</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1302</span>                                                                               {</div>
<div class="line"><span class="lineno"> 1303</span>  (void)path;</div>
<div class="line"><span class="lineno"> 1304</span>  (void)fi;</div>
<div class="line"><span class="lineno"> 1305</span>  <span class="keywordflow">if</span> (fsync(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>) &lt; 0)</div>
<div class="line"><span class="lineno"> 1306</span>    <span class="keywordflow">return</span> -errno;</div>
<div class="line"><span class="lineno"> 1307</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1308</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_afa59764091da583a569ad9e517043425_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_afa59764091da583a569ad9e517043425_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_afa59764091da583a569ad9e517043425_icgraph" id="ad2/d5a/fs_8c_afa59764091da583a569ad9e517043425_icgraph">
<area shape="rect" title="FUSE의 flush 호출 처리" alt="" coords="481,5,554,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#ae6af7e792b2c9c0e5b3f1d29d0d22925" title="flush 콜백" alt="" coords="316,5,433,33"/>
<area shape="poly" title=" " alt="" coords="466,22,434,22,434,16,466,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="301,22,269,22,269,16,301,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a36d02c17ab05553ae865cae9f1c85abc" name="a36d02c17ab05553ae865cae9f1c85abc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36d02c17ab05553ae865cae9f1c85abc">&#9670;&#160;</a></span>fs_format_filesystem()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int fs_format_filesystem </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d75/structsfuse__superblock.html">sfuse_superblock</a> *</td>          <td class="paramname"><span class="paramname"><em>sb</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>빈 이미지 파일을 VSFS 구조로 포맷 </p>
<p>디스크 이미지 파일을 초기화하여 슈퍼블록, 비트맵, 루트 아이노드를 설정하고 기록한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>디스크 이미지 파일 디스크립터 </td></tr>
    <tr><td class="paramname">sb</td><td>초기화된 슈퍼블록 정보를 저장할 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 -1 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00035">35</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">   35</span>                                                                     {</div>
<div class="line"><span class="lineno">   36</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">   37</span>  <span class="keywordflow">if</span> (fstat(fd, &amp;st) &lt; 0)</div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   39</span>  uint32_t total_all = st.st_size / <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>  <span class="comment">/* 비트맵 블록 수 계산 */</span></div>
<div class="line"><span class="lineno">   42</span>  uint32_t bm_blocks = (total_all &gt; 32768 ? 2 : 1);</div>
<div class="line"><span class="lineno">   43</span>  uint32_t inodes_per_block = <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> / <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a>);</div>
<div class="line"><span class="lineno">   44</span>  uint32_t it_blocks =</div>
<div class="line"><span class="lineno">   45</span>      (<a class="code hl_define" href="../../db/d98/super_8h.html#a54483f0a1c08c38a3e36bb5b5956e2c0">SFUSE_MAX_INODES</a> + inodes_per_block - 1) / inodes_per_block;</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>  <span class="comment">/* 디스크 용량 체크 */</span></div>
<div class="line"><span class="lineno">   48</span>  <span class="keywordflow">if</span> (total_all &lt;= 1 + 1 + bm_blocks + it_blocks)</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>  <span class="comment">/* 슈퍼블록 설정 */</span></div>
<div class="line"><span class="lineno">   52</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#ab78ed652d68ccbbd1a13d980f8f0b19d">magic</a> = <a class="code hl_define" href="../../db/d98/super_8h.html#ab3e43b63579c20a44aa0d16000a99599">SFUSE_MAGIC</a>;</div>
<div class="line"><span class="lineno">   53</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a0b37cfe3235e397d42dddc21183f688b">total_inodes</a> = <a class="code hl_define" href="../../db/d98/super_8h.html#a54483f0a1c08c38a3e36bb5b5956e2c0">SFUSE_MAX_INODES</a>;</div>
<div class="line"><span class="lineno">   54</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#aa9f7184193bd49902350f37506e020f1">inode_bitmap_start</a> = 1;</div>
<div class="line"><span class="lineno">   55</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a84178baed57f4e0c58f719a11a79c6e0">block_bitmap_start</a> = 2;</div>
<div class="line"><span class="lineno">   56</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a30e81477038d68463e47e95a2a898c3c">inode_table_start</a> = 2 + bm_blocks;</div>
<div class="line"><span class="lineno">   57</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> = sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a30e81477038d68463e47e95a2a898c3c">inode_table_start</a> + it_blocks;</div>
<div class="line"><span class="lineno">   58</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#af5c413e0bf39804304cad2b659941dd3">total_blocks</a> = total_all - sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>;</div>
<div class="line"><span class="lineno">   59</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a6e0f9e0ca0fc4e3f87f8bbc0eebd98c0">free_inodes</a> = <a class="code hl_define" href="../../db/d98/super_8h.html#a54483f0a1c08c38a3e36bb5b5956e2c0">SFUSE_MAX_INODES</a>;</div>
<div class="line"><span class="lineno">   60</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a81029117215606ca382047bf48bc49c5">free_blocks</a> = sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#af5c413e0bf39804304cad2b659941dd3">total_blocks</a>;</div>
<div class="line"><span class="lineno">   61</span> </div>
<div class="line"><span class="lineno">   62</span>  <span class="comment">/* 비트맵 초기화 (0으로 채움) */</span></div>
<div class="line"><span class="lineno">   63</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d35/structsfuse__bitmaps.html">sfuse_bitmaps</a> bmaps;</div>
<div class="line"><span class="lineno">   64</span>  memset(&amp;bmaps, 0, <span class="keyword">sizeof</span>(bmaps));</div>
<div class="line"><span class="lineno">   65</span>  <span class="comment">/* 아이노드 0,1 예약 (루트) */</span></div>
<div class="line"><span class="lineno">   66</span>  bmaps.inode.map[0] |= 0x03;</div>
<div class="line"><span class="lineno">   67</span>  sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a6e0f9e0ca0fc4e3f87f8bbc0eebd98c0">free_inodes</a> -= 2;</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>  <span class="comment">/* 루트 inode 초기화 */</span></div>
<div class="line"><span class="lineno">   70</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> root;</div>
<div class="line"><span class="lineno">   71</span>  memset(&amp;root, 0, <span class="keyword">sizeof</span>(root));</div>
<div class="line"><span class="lineno">   72</span>  root.mode = S_IFDIR | 0755;</div>
<div class="line"><span class="lineno">   73</span>  root.uid = getuid();</div>
<div class="line"><span class="lineno">   74</span>  root.gid = getgid();</div>
<div class="line"><span class="lineno">   75</span>  root.size = 0;</div>
<div class="line"><span class="lineno">   76</span>  time_t now = time(NULL);</div>
<div class="line"><span class="lineno">   77</span>  root.atime = root.mtime = root.ctime = (uint32_t)now;</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>  <span class="comment">/* 디스크에 기록 */</span></div>
<div class="line"><span class="lineno">   80</span>  <span class="comment">/* 1) 슈퍼블록 */</span></div>
<div class="line"><span class="lineno">   81</span>  <span class="keywordflow">if</span> (pwrite(fd, sb, <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>, 0) != <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>)</div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   83</span>  <span class="comment">/* 2) 아이노드 비트맵 */</span></div>
<div class="line"><span class="lineno">   84</span>  <span class="keywordflow">if</span> (pwrite(fd, &amp;bmaps.inode, <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>,</div>
<div class="line"><span class="lineno">   85</span>             sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#aa9f7184193bd49902350f37506e020f1">inode_bitmap_start</a> * <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>) &lt; 0)</div>
<div class="line"><span class="lineno">   86</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   87</span>  <span class="comment">/* 3) 블록 비트맵 */</span></div>
<div class="line"><span class="lineno">   88</span>  <span class="keywordflow">if</span> (pwrite(fd, &amp;bmaps.block, bm_blocks * <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>,</div>
<div class="line"><span class="lineno">   89</span>             sb-&gt;<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a84178baed57f4e0c58f719a11a79c6e0">block_bitmap_start</a> * <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>) &lt; 0)</div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   91</span>  <span class="comment">/* 4) 루트 아이노드 */</span></div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fd, sb, 1, &amp;root) &lt; 0)</div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   96</span>}</div>
<div class="ttc" id="astructsfuse__bitmaps_html"><div class="ttname"><a href="../../d2/d35/structsfuse__bitmaps.html">sfuse_bitmaps</a></div><div class="ttdoc">아이노드 비트맵과 블록 비트맵을 함께 담는 구조체</div><div class="ttdef"><b>Definition</b> <a href="../../da/dcb/bitmap_8h_source.html#l00030">bitmap.h:30</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a0b37cfe3235e397d42dddc21183f688b"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a0b37cfe3235e397d42dddc21183f688b">sfuse_superblock::total_inodes</a></div><div class="ttdeci">uint32_t total_inodes</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00053">super.h:53</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a30e81477038d68463e47e95a2a898c3c"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a30e81477038d68463e47e95a2a898c3c">sfuse_superblock::inode_table_start</a></div><div class="ttdeci">uint32_t inode_table_start</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00059">super.h:59</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a6e0f9e0ca0fc4e3f87f8bbc0eebd98c0"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a6e0f9e0ca0fc4e3f87f8bbc0eebd98c0">sfuse_superblock::free_inodes</a></div><div class="ttdeci">uint32_t free_inodes</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00055">super.h:55</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a81029117215606ca382047bf48bc49c5"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a81029117215606ca382047bf48bc49c5">sfuse_superblock::free_blocks</a></div><div class="ttdeci">uint32_t free_blocks</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00056">super.h:56</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_a84178baed57f4e0c58f719a11a79c6e0"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#a84178baed57f4e0c58f719a11a79c6e0">sfuse_superblock::block_bitmap_start</a></div><div class="ttdeci">uint32_t block_bitmap_start</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00058">super.h:58</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_aa9f7184193bd49902350f37506e020f1"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#aa9f7184193bd49902350f37506e020f1">sfuse_superblock::inode_bitmap_start</a></div><div class="ttdeci">uint32_t inode_bitmap_start</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00057">super.h:57</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_ab78ed652d68ccbbd1a13d980f8f0b19d"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#ab78ed652d68ccbbd1a13d980f8f0b19d">sfuse_superblock::magic</a></div><div class="ttdeci">uint32_t magic</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00052">super.h:52</a></div></div>
<div class="ttc" id="astructsfuse__superblock_html_af5c413e0bf39804304cad2b659941dd3"><div class="ttname"><a href="../../d7/d75/structsfuse__superblock.html#af5c413e0bf39804304cad2b659941dd3">sfuse_superblock::total_blocks</a></div><div class="ttdeci">uint32_t total_blocks</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00054">super.h:54</a></div></div>
<div class="ttc" id="asuper_8h_html_a54483f0a1c08c38a3e36bb5b5956e2c0"><div class="ttname"><a href="../../db/d98/super_8h.html#a54483f0a1c08c38a3e36bb5b5956e2c0">SFUSE_MAX_INODES</a></div><div class="ttdeci">#define SFUSE_MAX_INODES</div><div class="ttdoc">최대 아이노드 수</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00027">super.h:27</a></div></div>
<div class="ttc" id="asuper_8h_html_ab3e43b63579c20a44aa0d16000a99599"><div class="ttname"><a href="../../db/d98/super_8h.html#ab3e43b63579c20a44aa0d16000a99599">SFUSE_MAGIC</a></div><div class="ttdeci">#define SFUSE_MAGIC</div><div class="ttdoc">SFUSE 매직 넘버</div><div class="ttdef"><b>Definition</b> <a href="../../db/d98/super_8h_source.html#l00013">super.h:13</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a36d02c17ab05553ae865cae9f1c85abc_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a36d02c17ab05553ae865cae9f1c85abc_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a36d02c17ab05553ae865cae9f1c85abc_cgraph" id="ad2/d5a/fs_8c_a36d02c17ab05553ae865cae9f1c85abc_cgraph">
<area shape="rect" title="빈 이미지 파일을 VSFS 구조로 포맷" alt="" coords="5,5,166,33"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="214,5,308,33"/>
<area shape="poly" title=" " alt="" coords="166,16,198,16,198,22,166,22"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="356,5,458,33"/>
<area shape="poly" title=" " alt="" coords="308,16,341,16,341,22,308,22"/>
</map>
</div>

</div>
</div>
<a id="ab503c5dc5cb6a0dc77f0b6d92bfccf5f" name="ab503c5dc5cb6a0dc77f0b6d92bfccf5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab503c5dc5cb6a0dc77f0b6d92bfccf5f">&#9670;&#160;</a></span>fs_fsync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_fsync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>datasync</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct fuse_file_info *</td>          <td class="paramname"><span class="paramname"><em>fi</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 시스템 동기화 (flush/fsync) </p>
<p>FUSE에서 fsync 요청 처리</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>대상 경로 (사용되지 않음) </td></tr>
    <tr><td class="paramname">datasync</td><td>데이터만 동기화할지 여부 </td></tr>
    <tr><td class="paramname">fi</td><td>FUSE 파일 정보 구조체 (사용되지 않음) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01280">1280</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1281</span>                                        {</div>
<div class="line"><span class="lineno"> 1282</span>  (void)path;</div>
<div class="line"><span class="lineno"> 1283</span>  (void)fi;</div>
<div class="line"><span class="lineno"> 1284</span>  <span class="keywordflow">if</span> (datasync) {</div>
<div class="line"><span class="lineno"> 1285</span>    <span class="keywordflow">if</span> (fdatasync(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>) &lt; 0)</div>
<div class="line"><span class="lineno"> 1286</span>      <span class="keywordflow">return</span> -errno;</div>
<div class="line"><span class="lineno"> 1287</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1288</span>    <span class="keywordflow">if</span> (fsync(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>) &lt; 0)</div>
<div class="line"><span class="lineno"> 1289</span>      <span class="keywordflow">return</span> -errno;</div>
<div class="line"><span class="lineno"> 1290</span>  }</div>
<div class="line"><span class="lineno"> 1291</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1292</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_ab503c5dc5cb6a0dc77f0b6d92bfccf5f_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_ab503c5dc5cb6a0dc77f0b6d92bfccf5f_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_ab503c5dc5cb6a0dc77f0b6d92bfccf5f_icgraph" id="ad2/d5a/fs_8c_ab503c5dc5cb6a0dc77f0b6d92bfccf5f_icgraph">
<area shape="rect" title="파일 시스템 동기화 (flush/fsync)" alt="" coords="484,5,560,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a1fddf11f9d0514cb1ba55bddd68e3d7f" title="fsync 콜백" alt="" coords="316,5,436,33"/>
<area shape="poly" title=" " alt="" coords="469,22,436,22,436,16,469,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,269,22,269,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a012d00e6eafc0bb7c9402e3f36cee00a" name="a012d00e6eafc0bb7c9402e3f36cee00a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a012d00e6eafc0bb7c9402e3f36cee00a">&#9670;&#160;</a></span>fs_getattr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_getattr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct stat *</td>          <td class="paramname"><span class="paramname"><em>stbuf</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 또는 디렉터리 속성 가져오기 (stat) </p>
<p>파일/디렉터리 속성 조회</p>
<p>지정 경로의 inode를 조회하여 stat 구조체에 채움</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>대상 경로 문자열 </td></tr>
    <tr><td class="paramname">stbuf</td><td>속성 정보를 채울 stat 구조체 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00237">237</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  237</span>                                                                          {</div>
<div class="line"><span class="lineno">  238</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  239</span>  <span class="keywordtype">int</span> ret = <a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino);</div>
<div class="line"><span class="lineno">  240</span>  <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  241</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno">  244</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode) &lt; 0)</div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>  <span class="comment">/* stat 구조체 초기화 및 채우기 */</span></div>
<div class="line"><span class="lineno">  248</span>  memset(stbuf, 0, <span class="keyword">sizeof</span>(*stbuf));</div>
<div class="line"><span class="lineno">  249</span>  stbuf-&gt;st_mode = inode.mode;</div>
<div class="line"><span class="lineno">  250</span>  stbuf-&gt;st_nlink = S_ISDIR(inode.mode) ? 2 : 1;</div>
<div class="line"><span class="lineno">  251</span>  stbuf-&gt;st_uid = inode.uid;</div>
<div class="line"><span class="lineno">  252</span>  stbuf-&gt;st_gid = inode.gid;</div>
<div class="line"><span class="lineno">  253</span>  stbuf-&gt;st_size = inode.size;</div>
<div class="line"><span class="lineno">  254</span>  stbuf-&gt;st_atime = inode.atime;</div>
<div class="line"><span class="lineno">  255</span>  stbuf-&gt;st_mtime = inode.mtime;</div>
<div class="line"><span class="lineno">  256</span>  stbuf-&gt;st_ctime = inode.ctime;</div>
<div class="line"><span class="lineno">  257</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  258</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_cgraph" id="ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_cgraph">
<area shape="rect" title="파일 또는 디렉터리 속성 가져오기 (stat)" alt="" coords="5,32,90,60"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="138,7,262,34"/>
<area shape="poly" title=" " alt="" coords="90,36,122,31,123,36,91,41"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="447,57,540,85"/>
<area shape="poly" title=" " alt="" coords="90,46,432,65,432,70,90,51"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="310,7,399,34"/>
<area shape="poly" title=" " alt="" coords="263,18,294,18,294,23,263,23"/>
<area shape="poly" title=" " alt="" coords="396,32,440,49,438,54,394,37"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="447,5,540,33"/>
<area shape="poly" title=" " alt="" coords="400,17,432,17,432,22,400,23"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="588,57,690,85"/>
<area shape="poly" title=" " alt="" coords="540,68,572,68,572,74,540,74"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_icgraph" id="ad2/d5a/fs_8c_a012d00e6eafc0bb7c9402e3f36cee00a_icgraph">
<area shape="rect" title="파일 또는 디렉터리 속성 가져오기 (stat)" alt="" coords="493,5,578,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6c01c3409d41549c5ca34b9a2f64ccfe" title="파일/디렉터리 속성 조회 콜백" alt="" coords="316,5,445,33"/>
<area shape="poly" title=" " alt="" coords="478,22,446,22,446,16,478,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a2647416442bb14c576015d7afa69ac81" name="a2647416442bb14c576015d7afa69ac81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2647416442bb14c576015d7afa69ac81">&#9670;&#160;</a></span>fs_initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> * fs_initialize </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>error_out</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SFUSE FS 초기화 </p>
<p>파일 시스템 초기화</p>
<ul>
<li>블록 디바이스 여부를 if (ioctl(fd, BLKGETSIZE64, &amp;size64) &lt; 0) {검사해, 블록 디바이스는 ioctl(BLKGETSIZE64)로 크기 취득</li>
<li>일반 파일(이미지)인 경우만 lseek/SEEK_END와 ftruncate 사용 </li>
</ul>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00105">105</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  105</span>                                                                 {</div>
<div class="line"><span class="lineno">  106</span>  <span class="keywordtype">int</span> fd = open(path, O_RDWR);</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line"><span class="lineno">  108</span>    *error_out = errno;</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  110</span>  }</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  113</span>  <span class="keywordflow">if</span> (fstat(fd, &amp;st) &lt; 0) {</div>
<div class="line"><span class="lineno">  114</span>    *error_out = errno;</div>
<div class="line"><span class="lineno">  115</span>    close(fd);</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  117</span>  }</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>  off_t img_size;</div>
<div class="line"><span class="lineno">  120</span>  <span class="keywordtype">bool</span> is_blkdev = S_ISBLK(st.st_mode);</div>
<div class="line"><span class="lineno">  121</span>  <span class="keywordflow">if</span> (is_blkdev) {</div>
<div class="line"><span class="lineno">  122</span>    <span class="comment">// 블록 디바이스: ioctl로 전체 크기(바이트) 가져오기</span></div>
<div class="line"><span class="lineno">  123</span>    uint64_t size64;</div>
<div class="line"><span class="lineno">  124</span>    <span class="keywordflow">if</span> (ioctl(fd, BLKGETSIZE64, &amp;size64) &lt; 0) {</div>
<div class="line"><span class="lineno">  125</span>      *error_out = errno;</div>
<div class="line"><span class="lineno">  126</span>      close(fd);</div>
<div class="line"><span class="lineno">  127</span>      <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  128</span>    }</div>
<div class="line"><span class="lineno">  129</span>    img_size = size64;</div>
<div class="line"><span class="lineno">  130</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// 일반 파일: lseek로 크기 측정</span></div>
<div class="line"><span class="lineno">  132</span>    img_size = lseek(fd, 0, SEEK_END);</div>
<div class="line"><span class="lineno">  133</span>    <span class="keywordflow">if</span> (img_size &lt; 0) {</div>
<div class="line"><span class="lineno">  134</span>      *error_out = errno;</div>
<div class="line"><span class="lineno">  135</span>      close(fd);</div>
<div class="line"><span class="lineno">  136</span>      <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  137</span>    }</div>
<div class="line"><span class="lineno">  138</span>  }</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>  <span class="comment">// 강제 포맷 시 이미지 파일만 ftruncate — 블록 디바이스는 넘어감</span></div>
<div class="line"><span class="lineno">  141</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../df/d26/fs_8h.html#a0771760ee8a223b01c598e70420cef0c">g_force_format</a> &amp;&amp; !is_blkdev) {</div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordflow">if</span> (ftruncate(fd, img_size) &lt; 0) {</div>
<div class="line"><span class="lineno">  143</span>      *error_out = errno;</div>
<div class="line"><span class="lineno">  144</span>      close(fd);</div>
<div class="line"><span class="lineno">  145</span>      <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  146</span>    }</div>
<div class="line"><span class="lineno">  147</span>  }</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>  <span class="comment">// 다음 I/O를 위해 파일 포인터를 맨 앞으로</span></div>
<div class="line"><span class="lineno">  150</span>  <span class="keywordflow">if</span> (lseek(fd, 0, SEEK_SET) &lt; 0) {</div>
<div class="line"><span class="lineno">  151</span>    *error_out = errno;</div>
<div class="line"><span class="lineno">  152</span>    close(fd);</div>
<div class="line"><span class="lineno">  153</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  154</span>  }</div>
<div class="line"><span class="lineno">  155</span>}</div>
<div class="ttc" id="afs_8h_html_a0771760ee8a223b01c598e70420cef0c"><div class="ttname"><a href="../../df/d26/fs_8h.html#a0771760ee8a223b01c598e70420cef0c">g_force_format</a></div><div class="ttdeci">bool g_force_format</div><div class="ttdoc">강제 포맷 옵션 플래그</div><div class="ttdef"><b>Definition</b> <a href="../../d0/d29/main_8c_source.html#l00032">main.c:32</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a2647416442bb14c576015d7afa69ac81_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a2647416442bb14c576015d7afa69ac81_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a2647416442bb14c576015d7afa69ac81_icgraph" id="ad2/d5a/fs_8c_a2647416442bb14c576015d7afa69ac81_icgraph">
<area shape="rect" title="SFUSE FS 초기화" alt="" coords="108,5,204,33"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a0e6c18058ed432a1b33962e1f7fda11f" name="a0e6c18058ed432a1b33962e1f7fda11f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e6c18058ed432a1b33962e1f7fda11f">&#9670;&#160;</a></span>fs_mkdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_mkdir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t</td>          <td class="paramname"><span class="paramname"><em>mode</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>새 디렉터리 생성 </p>
<p>디렉터리 생성</p>
<p>지정된 경로에 새 디렉터리를 생성하고 상위 디렉터리에 디렉터리 엔트리를 추가한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>생성할 디렉터리 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">mode</td><td>디렉터리 모드 및 권한 (하위 12비트 사용) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 디렉터리 타입 설정</p>
<p>&lt; 첫 엔트리에 새 inode 설정</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 디렉터리 크기 갱신</p>
<p>&lt; 빈 슬롯에 inode 설정</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 수정 시간 갱신</p>
<p>&lt; 변경 시간 갱신</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00702">702</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  702</span>                                                                 {</div>
<div class="line"><span class="lineno">  703</span>  uint32_t dummy;</div>
<div class="line"><span class="lineno">  704</span>  <span class="comment">/* 이미 존재하면 실패 */</span></div>
<div class="line"><span class="lineno">  705</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;dummy) == 0) {</div>
<div class="line"><span class="lineno">  706</span>    <span class="keywordflow">return</span> -EEXIST;</div>
<div class="line"><span class="lineno">  707</span>  }</div>
<div class="line"><span class="lineno">  708</span> </div>
<div class="line"><span class="lineno">  709</span>  <span class="comment">/* 상위 디렉터리와 새 이름 분리 */</span></div>
<div class="line"><span class="lineno">  710</span>  <span class="keywordtype">char</span> *path_copy = strdup(path);</div>
<div class="line"><span class="lineno">  711</span>  <span class="keywordflow">if</span> (!path_copy)</div>
<div class="line"><span class="lineno">  712</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno">  713</span>  <span class="keywordtype">char</span> *name = strrchr(path_copy, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  714</span>  <span class="keywordflow">if</span> (!name || *(name + 1) == <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno">  715</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  716</span>    <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><span class="lineno">  717</span>  }</div>
<div class="line"><span class="lineno">  718</span>  *name = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  719</span>  <span class="keywordtype">char</span> *parent_path = (*path_copy == <span class="charliteral">&#39;\0&#39;</span>) ? <span class="stringliteral">&quot;/&quot;</span> : path_copy;</div>
<div class="line"><span class="lineno">  720</span>  name++;</div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span>  <span class="comment">/* 상위 디렉터리 inode 조회 */</span></div>
<div class="line"><span class="lineno">  723</span>  uint32_t parent_ino;</div>
<div class="line"><span class="lineno">  724</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, parent_path, &amp;parent_ino) &lt; 0) {</div>
<div class="line"><span class="lineno">  725</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  726</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  727</span>  }</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> parent_inode;</div>
<div class="line"><span class="lineno">  730</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  731</span>  <span class="comment">/* 상위가 디렉터리가 아니면 오류 */</span></div>
<div class="line"><span class="lineno">  732</span>  <span class="keywordflow">if</span> ((parent_inode.mode &amp; S_IFDIR) == 0) {</div>
<div class="line"><span class="lineno">  733</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  734</span>    <span class="keywordflow">return</span> -ENOTDIR;</div>
<div class="line"><span class="lineno">  735</span>  }</div>
<div class="line"><span class="lineno">  736</span> </div>
<div class="line"><span class="lineno">  737</span>  <span class="comment">/* 새 아이노드 할당 */</span></div>
<div class="line"><span class="lineno">  738</span>  <span class="keywordtype">int</span> new_ino = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a08b712b2489ab7b3346f82316300c6b3">alloc_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>);</div>
<div class="line"><span class="lineno">  739</span>  <span class="keywordflow">if</span> (new_ino &lt; 0) {</div>
<div class="line"><span class="lineno">  740</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  741</span>    <span class="keywordflow">return</span> new_ino;</div>
<div class="line"><span class="lineno">  742</span>  }</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>  <span class="comment">/* 새 아이노드 초기화 */</span></div>
<div class="line"><span class="lineno">  745</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> new_inode;</div>
<div class="line"><span class="lineno">  746</span>  memset(&amp;new_inode, 0, <span class="keyword">sizeof</span>(new_inode));</div>
<div class="line"><span class="lineno">  747</span>  new_inode.mode = (<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a399b204af355418f3faa7cde72389973">mode</a> &amp; 0xFFF) | S_IFDIR; </div>
<div class="line"><span class="lineno">  748</span>  new_inode.uid = getuid();</div>
<div class="line"><span class="lineno">  749</span>  new_inode.gid = getgid();</div>
<div class="line"><span class="lineno">  750</span>  new_inode.size = 0;</div>
<div class="line"><span class="lineno">  751</span>  time_t now = time(NULL);</div>
<div class="line"><span class="lineno">  752</span>  new_inode.atime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  753</span>  new_inode.mtime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  754</span>  new_inode.ctime = (uint32_t)now;</div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span>  <span class="comment">/* 상위 디렉터리에 엔트리 추가 (메모리 안전성: 블록 전체 초기화) */</span></div>
<div class="line"><span class="lineno">  757</span>  uint8_t dir_block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  758</span>  <span class="keywordtype">bool</span> added = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  759</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 12 &amp;&amp; !added; ++i) {</div>
<div class="line"><span class="lineno">  760</span>    <span class="keywordflow">if</span> (parent_inode.direct[i] == 0) {</div>
<div class="line"><span class="lineno">  761</span>      <span class="comment">/* 새 디렉터리 블록 할당 */</span></div>
<div class="line"><span class="lineno">  762</span>      <span class="keywordtype">int</span> new_dir_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  763</span>      <span class="keywordflow">if</span> (new_dir_block &lt; 0) {</div>
<div class="line"><span class="lineno">  764</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  765</span>        free(path_copy);</div>
<div class="line"><span class="lineno">  766</span>        <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  767</span>      }</div>
<div class="line"><span class="lineno">  768</span>      parent_inode.direct[i] =</div>
<div class="line"><span class="lineno">  769</span>          fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> + (uint32_t)new_dir_block;</div>
<div class="line"><span class="lineno">  770</span> </div>
<div class="line"><span class="lineno">  771</span>      memset(dir_block, 0, <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>);</div>
<div class="line"><span class="lineno">  772</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)dir_block;</div>
<div class="line"><span class="lineno">  773</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = new_ino; </div>
<div class="line"><span class="lineno">  774</span>      strncpy(entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno">  775</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[<a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  776</span> </div>
<div class="line"><span class="lineno">  777</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block);</div>
<div class="line"><span class="lineno">  778</span>      parent_inode.size += <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno">  779</span>      added = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  780</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  781</span>      <span class="comment">/* 기존 블록에서 빈 슬롯 검색 */</span></div>
<div class="line"><span class="lineno">  782</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block) &lt; 0) {</div>
<div class="line"><span class="lineno">  783</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  784</span>        free(path_copy);</div>
<div class="line"><span class="lineno">  785</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  786</span>      }</div>
<div class="line"><span class="lineno">  787</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)dir_block;</div>
<div class="line"><span class="lineno">  788</span>      <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno">  789</span>        <span class="keywordflow">if</span> (entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> == 0) {</div>
<div class="line"><span class="lineno">  790</span>          entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = new_ino; </div>
<div class="line"><span class="lineno">  791</span>          strncpy(entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno">  792</span>          entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[<a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  793</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block);</div>
<div class="line"><span class="lineno">  794</span>          added = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  795</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  796</span>        }</div>
<div class="line"><span class="lineno">  797</span>      }</div>
<div class="line"><span class="lineno">  798</span>    }</div>
<div class="line"><span class="lineno">  799</span>  }</div>
<div class="line"><span class="lineno">  800</span> </div>
<div class="line"><span class="lineno">  801</span>  <span class="comment">/* 공간 부족 시 롤백 */</span></div>
<div class="line"><span class="lineno">  802</span>  <span class="keywordflow">if</span> (!added) {</div>
<div class="line"><span class="lineno">  803</span>    <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, new_ino);</div>
<div class="line"><span class="lineno">  804</span>    free(path_copy);</div>
<div class="line"><span class="lineno">  805</span>    <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  806</span>  }</div>
<div class="line"><span class="lineno">  807</span> </div>
<div class="line"><span class="lineno">  808</span>  <span class="comment">/* 새 아이노드 디스크에 기록 */</span></div>
<div class="line"><span class="lineno">  809</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, new_ino, &amp;new_inode);</div>
<div class="line"><span class="lineno">  810</span> </div>
<div class="line"><span class="lineno">  811</span>  <span class="comment">/* 상위 디렉터리 메타데이터 갱신 */</span></div>
<div class="line"><span class="lineno">  812</span>  parent_inode.mtime = (uint32_t)now; </div>
<div class="line"><span class="lineno">  813</span>  parent_inode.ctime = (uint32_t)now; </div>
<div class="line"><span class="lineno">  814</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  815</span> </div>
<div class="line"><span class="lineno">  816</span>  free(path_copy);</div>
<div class="line"><span class="lineno">  817</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  818</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_cgraph" id="ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_cgraph">
<area shape="rect" title="새 디렉터리 생성" alt="" coords="5,185,84,213"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a7342a6b6280af158749416ff1fffadfc" title="슈퍼블록 기반으로 데이터 블록 할당" alt="" coords="147,5,241,33"/>
<area shape="poly" title=" " alt="" coords="48,184,76,118,99,79,130,44,135,39,139,44,134,48,104,82,80,121,53,186"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a08b712b2489ab7b3346f82316300c6b3" title="슈퍼블록 기반으로 아이노드 할당" alt="" coords="146,57,242,85"/>
<area shape="poly" title=" " alt="" coords="53,183,84,141,106,117,130,96,138,91,141,95,133,100,109,121,88,144,57,187"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a156ed842116a648997c737d182b7416a" title="슈퍼블록 기반으로 아이노드 해제" alt="" coords="149,109,239,137"/>
<area shape="poly" title=" " alt="" coords="73,182,150,142,153,147,75,187"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="132,261,256,289"/>
<area shape="poly" title=" " alt="" coords="75,211,153,251,150,256,73,216"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="442,264,535,292"/>
<area shape="poly" title=" " alt="" coords="55,212,84,257,106,280,133,298,171,312,210,320,251,322,292,321,368,310,432,294,433,299,369,316,292,327,251,328,210,325,169,317,130,303,103,285,80,261,50,215"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="442,212,535,240"/>
<area shape="poly" title=" " alt="" coords="84,199,427,220,426,225,84,204"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="441,160,536,188"/>
<area shape="poly" title=" " alt="" coords="84,194,425,175,426,180,84,200"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="146,363,242,390"/>
<area shape="poly" title=" " alt="" coords="53,212,82,273,105,310,134,343,146,352,143,357,130,346,101,313,78,276,49,214"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad195af185232b43149a1d9442e28d077" title="비트맵에서 0인 비트를 찾아 1로 설정하고 인덱스를 반환" alt="" coords="310,32,387,60"/>
<area shape="poly" title=" " alt="" coords="242,25,296,34,295,39,241,30"/>
<area shape="poly" title=" " alt="" coords="242,61,294,52,295,57,243,66"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a9d97a51ca0096c6fe7bf18c3947d2abb" title="비트맵에서 지정한 인덱스 비트를 0으로 설정" alt="" coords="313,109,384,137"/>
<area shape="poly" title=" " alt="" coords="240,120,298,120,298,126,240,126"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="304,261,393,289"/>
<area shape="poly" title=" " alt="" coords="257,272,288,272,288,278,257,278"/>
<area shape="poly" title=" " alt="" coords="394,273,427,274,427,279,394,279"/>
<area shape="poly" title=" " alt="" coords="389,258,432,243,434,248,391,263"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="584,212,686,240"/>
<area shape="poly" title=" " alt="" coords="529,261,579,243,581,248,531,266"/>
<area shape="poly" title=" " alt="" coords="531,186,581,204,579,209,529,191"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_icgraph" id="ad2/d5a/fs_8c_a0e6c18058ed432a1b33962e1f7fda11f_icgraph">
<area shape="rect" title="새 디렉터리 생성" alt="" coords="487,5,566,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acac9f9c69134190f86e015e89e39d43f" title="디렉터리 생성 콜백" alt="" coords="316,5,439,33"/>
<area shape="poly" title=" " alt="" coords="472,22,440,22,440,16,472,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a9741976c80c2167280c9a0c3ff856d2d" name="a9741976c80c2167280c9a0c3ff856d2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9741976c80c2167280c9a0c3ff856d2d">&#9670;&#160;</a></span>fs_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct fuse_file_info *</td>          <td class="paramname"><span class="paramname"><em>fi</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 열기 (존재 여부만 확인) </p>
<p>파일 열기</p>
<p>path가 유효한 파일인지 확인</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>열고자 하는 파일 경로 문자열 </td></tr>
    <tr><td class="paramname">fi</td><td>FUSE 파일 정보 구조체 (사용하지 않음) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 -ENOENT </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00290">290</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  290</span>                                                                              {</div>
<div class="line"><span class="lineno">  291</span>  (void)fi;</div>
<div class="line"><span class="lineno">  292</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  293</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0)</div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  295</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  296</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_cgraph" id="ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_cgraph">
<area shape="rect" title="파일 열기 (존재 여부만 확인)" alt="" coords="5,32,78,60"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="126,32,250,60"/>
<area shape="poly" title=" " alt="" coords="78,43,110,43,110,48,78,48"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="298,32,387,60"/>
<area shape="poly" title=" " alt="" coords="251,43,282,43,282,48,251,48"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="435,5,528,33"/>
<area shape="poly" title=" " alt="" coords="387,35,419,28,421,34,388,40"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="435,57,528,85"/>
<area shape="poly" title=" " alt="" coords="388,51,420,57,420,63,387,57"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="576,5,678,33"/>
<area shape="poly" title=" " alt="" coords="528,16,560,16,560,22,528,22"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_icgraph" id="ad2/d5a/fs_8c_a9741976c80c2167280c9a0c3ff856d2d_icgraph">
<area shape="rect" title="파일 열기 (존재 여부만 확인)" alt="" coords="481,5,554,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a62bb834f4955786318b1c8588cbb0135" title="파일 열기 콜백" alt="" coords="316,5,433,33"/>
<area shape="poly" title=" " alt="" coords="466,22,434,22,434,16,466,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="301,22,269,22,269,16,301,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a28b88e33bc2ea2e1f024968f35073824" name="a28b88e33bc2ea2e1f024968f35073824"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28b88e33bc2ea2e1f024968f35073824">&#9670;&#160;</a></span>fs_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t</td>          <td class="paramname"><span class="paramname"><em>offset</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 읽기 </p>
<p>지정된 경로의 파일 데이터를 읽어 사용자 버퍼에 복사한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>읽을 파일 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">buf</td><td>데이터를 저장할 사용자 버퍼 포인터 </td></tr>
    <tr><td class="paramname">size</td><td>요청한 읽기 크기 (바이트 단위) </td></tr>
    <tr><td class="paramname">offset</td><td>파일 내 시작 오프셋 (바이트 단위) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>읽은 바이트 수 (&gt;=0), 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 논리 블록 인덱스</p>
<p>&lt; 블록 내 오프셋</p>
<p>&lt; 이터레이션당 최대 읽기 바이트</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00310">310</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  311</span>                          {</div>
<div class="line"><span class="lineno">  312</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  313</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0)</div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno">  317</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode) &lt; 0)</div>
<div class="line"><span class="lineno">  318</span>    <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>  <span class="comment">/* 디렉터리는 읽을 수 없음 */</span></div>
<div class="line"><span class="lineno">  321</span>  <span class="keywordflow">if</span> ((inode.mode &amp; S_IFDIR) == S_IFDIR)</div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">return</span> -EISDIR;</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <span class="comment">/* 오프셋이 파일 크기를 넘으면 0 리턴 */</span></div>
<div class="line"><span class="lineno">  325</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)offset &gt;= inode.size)</div>
<div class="line"><span class="lineno">  326</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>  <span class="comment">/* 요청 크기가 파일 끝을 넘으면 조정 */</span></div>
<div class="line"><span class="lineno">  329</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)offset + <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> &gt; inode.size)</div>
<div class="line"><span class="lineno">  330</span>    <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> = inode.<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - offset;</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>  <span class="keywordtype">size_t</span> bytes_read = 0;</div>
<div class="line"><span class="lineno">  333</span>  uint8_t block_buf[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>  <span class="comment">/* 필요한 블록을 반복해서 읽음 */</span></div>
<div class="line"><span class="lineno">  336</span>  <span class="keywordflow">while</span> (bytes_read &lt; <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a>) {</div>
<div class="line"><span class="lineno">  337</span>    uint32_t block_index =</div>
<div class="line"><span class="lineno">  338</span>        (offset + bytes_read) / <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno">  339</span>    uint32_t block_offset =</div>
<div class="line"><span class="lineno">  340</span>        (offset + bytes_read) % <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno">  341</span>    uint32_t to_read =</div>
<div class="line"><span class="lineno">  342</span>        <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> - block_offset; </div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    <span class="keywordflow">if</span> (to_read &gt; <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - bytes_read)</div>
<div class="line"><span class="lineno">  345</span>      to_read = <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - bytes_read;</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>    uint32_t disk_block = 0;</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">/* 직접 블록 참조 */</span></div>
<div class="line"><span class="lineno">  350</span>    <span class="keywordflow">if</span> (block_index &lt; 12U) {</div>
<div class="line"><span class="lineno">  351</span>      disk_block = inode.direct[block_index];</div>
<div class="line"><span class="lineno">  352</span>    }</div>
<div class="line"><span class="lineno">  353</span>    <span class="comment">/* 단일 간접 블록 참조 */</span></div>
<div class="line"><span class="lineno">  354</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (block_index &lt; 12U + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>) {</div>
<div class="line"><span class="lineno">  355</span>      <span class="keywordflow">if</span> (!inode.indirect)</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  357</span>      uint32_t ptrs[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  358</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs) &lt; 0)</div>
<div class="line"><span class="lineno">  359</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  360</span>      disk_block = ptrs[block_index - 12U];</div>
<div class="line"><span class="lineno">  361</span>    }</div>
<div class="line"><span class="lineno">  362</span>    <span class="comment">/* 이중 간접 블록 참조 */</span></div>
<div class="line"><span class="lineno">  363</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  364</span>      <span class="keywordflow">if</span> (!inode.double_indirect)</div>
<div class="line"><span class="lineno">  365</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  366</span>      uint32_t l1[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  367</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, l1) &lt; 0)</div>
<div class="line"><span class="lineno">  368</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  369</span>      uint32_t dbl_index = block_index - (12U + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>);</div>
<div class="line"><span class="lineno">  370</span>      uint32_t l1_idx = dbl_index / <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>;</div>
<div class="line"><span class="lineno">  371</span>      uint32_t l2_idx = dbl_index % <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>;</div>
<div class="line"><span class="lineno">  372</span>      <span class="keywordflow">if</span> (l1_idx &gt;= <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a> || l1[l1_idx] == 0)</div>
<div class="line"><span class="lineno">  373</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  374</span>      uint32_t l2[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  375</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[l1_idx], l2) &lt; 0)</div>
<div class="line"><span class="lineno">  376</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  377</span>      disk_block = l2[l2_idx];</div>
<div class="line"><span class="lineno">  378</span>    }</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>    <span class="comment">/* 할당되지 않은 블록이면 0으로 채움 */</span></div>
<div class="line"><span class="lineno">  381</span>    <span class="keywordflow">if</span> (disk_block == 0) {</div>
<div class="line"><span class="lineno">  382</span>      memset(buf + bytes_read, 0, to_read);</div>
<div class="line"><span class="lineno">  383</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  384</span>      <span class="comment">/* 실제 디스크 읽기 */</span></div>
<div class="line"><span class="lineno">  385</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, disk_block, block_buf) &lt; 0)</div>
<div class="line"><span class="lineno">  386</span>        <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  387</span>      memcpy(buf + bytes_read, block_buf + block_offset, to_read);</div>
<div class="line"><span class="lineno">  388</span>    }</div>
<div class="line"><span class="lineno">  389</span>    bytes_read += to_read;</div>
<div class="line"><span class="lineno">  390</span>  }</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>  <span class="keywordflow">return</span> bytes_read;</div>
<div class="line"><span class="lineno">  393</span>}</div>
<div class="ttc" id="ainode_8h_html_a113396e915a4441e2d49df4b7bb6d26c"><div class="ttname"><a href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a></div><div class="ttdeci">#define SFUSE_PTRS_PER_BLOCK</div><div class="ttdoc">한 블록에 담을 수 있는 포인터 수 (32-bit)</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d73/inode_8h_source.html#l00017">inode.h:17</a></div></div>
<div class="ttc" id="astructsfuse__inode_html_a8f67762b0e63a291da0db528b627922c"><div class="ttname"><a href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">sfuse_inode::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d73/inode_8h_source.html#l00026">inode.h:26</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_cgraph" id="ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_cgraph">
<area shape="rect" title="파일 읽기" alt="" coords="5,43,75,70"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="123,43,247,70"/>
<area shape="poly" title=" " alt="" coords="75,54,107,54,107,59,75,59"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="432,5,525,33"/>
<area shape="poly" title=" " alt="" coords="75,41,122,29,202,19,281,14,417,14,417,19,282,19,202,24,123,34,76,46"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="432,69,525,97"/>
<area shape="poly" title=" " alt="" coords="76,67,123,79,202,88,282,90,417,86,417,91,282,95,202,93,122,84,75,72"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="295,43,384,70"/>
<area shape="poly" title=" " alt="" coords="248,54,279,54,279,59,248,59"/>
<area shape="poly" title=" " alt="" coords="384,42,417,33,418,38,386,47"/>
<area shape="poly" title=" " alt="" coords="385,62,418,69,416,74,384,68"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="573,5,675,33"/>
<area shape="poly" title=" " alt="" coords="525,16,557,16,557,22,525,22"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_icgraph" id="ad2/d5a/fs_8c_a28b88e33bc2ea2e1f024968f35073824_icgraph">
<area shape="rect" title="파일 읽기" alt="" coords="478,5,548,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a4e8379279e62363763d8c7da873361d7" title="파일 읽기 콜백" alt="" coords="316,5,430,33"/>
<area shape="poly" title=" " alt="" coords="463,22,431,22,431,16,463,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="addbb0f0d2e2d634975c40330e23bc8ae" name="addbb0f0d2e2d634975c40330e23bc8ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addbb0f0d2e2d634975c40330e23bc8ae">&#9670;&#160;</a></span>fs_readdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_readdir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fuse_fill_dir_t</td>          <td class="paramname"><span class="paramname"><em>filler</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t</td>          <td class="paramname"><span class="paramname"><em>offset</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>디렉터리 목록 가져오기 </p>
<p>디렉터리 내용 읽기</p>
<p>지정 경로의 디렉터리 엔트리를 FUSE callback에 전달</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>디렉터리 경로 문자열 </td></tr>
    <tr><td class="paramname">buf</td><td>FUSE가 제공하는 버퍼 포인터 </td></tr>
    <tr><td class="paramname">filler</td><td>FUSE 디렉터리 엔트리 추가 콜백 </td></tr>
    <tr><td class="paramname">offset</td><td>읽기 시작 오프셋 (사용되지 않음) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00272">272</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  273</span>                                                     {</div>
<div class="line"><span class="lineno">  274</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  275</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0)</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  277</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="../../df/d9c/dir_8h.html#aca2f1f6050fc83a31ced84d12a96b4cb">dir_list</a>(fs, ino, buf, filler, offset);</div>
<div class="line"><span class="lineno">  278</span>}</div>
<div class="ttc" id="adir_8h_html_aca2f1f6050fc83a31ced84d12a96b4cb"><div class="ttname"><a href="../../df/d9c/dir_8h.html#aca2f1f6050fc83a31ced84d12a96b4cb">dir_list</a></div><div class="ttdeci">int dir_list(const struct sfuse_fs *fs, uint32_t dir_ino, void *buf, fuse_fill_dir_t filler, off_t offset)</div><div class="ttdoc">FUSE용 디렉터리 목록 채우기 콜백 호출</div><div class="ttdef"><b>Definition</b> <a href="../../de/d32/dir_8c_source.html#l00058">dir.c:58</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_cgraph" id="ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_cgraph">
<area shape="rect" title="디렉터리 목록 가져오기" alt="" coords="5,32,92,60"/>
<area shape="rect" href="../../de/d32/dir_8c.html#aca2f1f6050fc83a31ced84d12a96b4cb" title="FUSE용 디렉터리 목록 채우기 콜백 호출" alt="" coords="324,5,389,33"/>
<area shape="poly" title=" " alt="" coords="92,39,308,21,309,26,93,45"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="140,57,264,85"/>
<area shape="poly" title=" " alt="" coords="93,50,125,56,124,61,92,56"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="449,5,542,33"/>
<area shape="poly" title=" " alt="" coords="390,16,434,16,434,22,390,22"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="449,57,542,85"/>
<area shape="poly" title=" " alt="" coords="391,29,443,49,441,54,389,34"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="590,5,692,33"/>
<area shape="poly" title=" " alt="" coords="542,16,574,16,574,22,542,22"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="312,57,401,85"/>
<area shape="poly" title=" " alt="" coords="265,68,296,68,296,74,265,74"/>
<area shape="poly" title=" " alt="" coords="395,54,441,37,443,42,397,59"/>
<area shape="poly" title=" " alt="" coords="402,68,434,68,434,74,402,74"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_icgraph" id="ad2/d5a/fs_8c_addbb0f0d2e2d634975c40330e23bc8ae_icgraph">
<area shape="rect" title="디렉터리 목록 가져오기" alt="" coords="495,5,582,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acdaffbb59b5fe7d0ceda916714ddc3ad" title="디렉터리 목록 조회 콜백" alt="" coords="316,5,447,33"/>
<area shape="poly" title=" " alt="" coords="480,22,448,22,448,16,480,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="af677d22449626003a22868b28501f79a" name="af677d22449626003a22868b28501f79a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af677d22449626003a22868b28501f79a">&#9670;&#160;</a></span>fs_rename()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_rename </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>from</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>to</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 또는 디렉터리 이름 변경 (이동) </p>
<p>파일 또는 디렉터리 이름 변경</p>
<p>지정된 경로의 엔트리를 원본 디렉터리에서 제거하고, 대상 디렉터리에 새 엔트리를 추가한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">from</td><td>원본 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">to</td><td>대상 경로 (null-terminated 문자열) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01011">1011</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1011</span>                                                                     {</div>
<div class="line"><span class="lineno"> 1012</span>  uint32_t src_ino;</div>
<div class="line"><span class="lineno"> 1013</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, from, &amp;src_ino) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1014</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno"> 1015</span>  }</div>
<div class="line"><span class="lineno"> 1016</span>  uint32_t dummy;</div>
<div class="line"><span class="lineno"> 1017</span>  <span class="comment">/* 대상이 이미 존재하면 실패 */</span></div>
<div class="line"><span class="lineno"> 1018</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, to, &amp;dummy) == 0) {</div>
<div class="line"><span class="lineno"> 1019</span>    <span class="keywordflow">return</span> -EEXIST;</div>
<div class="line"><span class="lineno"> 1020</span>  }</div>
<div class="line"><span class="lineno"> 1021</span> </div>
<div class="line"><span class="lineno"> 1022</span>  <span class="comment">/* 경로 복사 및 분할 */</span></div>
<div class="line"><span class="lineno"> 1023</span>  <span class="keywordtype">char</span> *from_copy = strdup(from);</div>
<div class="line"><span class="lineno"> 1024</span>  <span class="keywordtype">char</span> *to_copy = strdup(to);</div>
<div class="line"><span class="lineno"> 1025</span>  <span class="keywordflow">if</span> (!from_copy || !to_copy) {</div>
<div class="line"><span class="lineno"> 1026</span>    free(from_copy);</div>
<div class="line"><span class="lineno"> 1027</span>    free(to_copy);</div>
<div class="line"><span class="lineno"> 1028</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno"> 1029</span>  }</div>
<div class="line"><span class="lineno"> 1030</span>  <span class="keywordtype">char</span> *from_name = strrchr(from_copy, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno"> 1031</span>  <span class="keywordtype">char</span> *to_name = strrchr(to_copy, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno"> 1032</span>  *from_name = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1033</span>  *to_name = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1034</span>  <span class="keywordtype">char</span> *from_parent_path = (*from_copy == <span class="charliteral">&#39;\0&#39;</span>) ? <span class="stringliteral">&quot;/&quot;</span> : from_copy;</div>
<div class="line"><span class="lineno"> 1035</span>  <span class="keywordtype">char</span> *to_parent_path = (*to_copy == <span class="charliteral">&#39;\0&#39;</span>) ? <span class="stringliteral">&quot;/&quot;</span> : to_copy;</div>
<div class="line"><span class="lineno"> 1036</span>  from_name++;</div>
<div class="line"><span class="lineno"> 1037</span>  to_name++;</div>
<div class="line"><span class="lineno"> 1038</span> </div>
<div class="line"><span class="lineno"> 1039</span>  <span class="comment">/* 부모 디렉터리 inode 조회 */</span></div>
<div class="line"><span class="lineno"> 1040</span>  uint32_t from_parent_ino, to_parent_ino;</div>
<div class="line"><span class="lineno"> 1041</span>  <a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, from_parent_path, &amp;from_parent_ino);</div>
<div class="line"><span class="lineno"> 1042</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, to_parent_path, &amp;to_parent_ino) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1043</span>    free(from_copy);</div>
<div class="line"><span class="lineno"> 1044</span>    free(to_copy);</div>
<div class="line"><span class="lineno"> 1045</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno"> 1046</span>  }</div>
<div class="line"><span class="lineno"> 1047</span> </div>
<div class="line"><span class="lineno"> 1048</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> from_parent_inode, to_parent_inode;</div>
<div class="line"><span class="lineno"> 1049</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, from_parent_ino, &amp;from_parent_inode);</div>
<div class="line"><span class="lineno"> 1050</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, to_parent_ino, &amp;to_parent_inode);</div>
<div class="line"><span class="lineno"> 1051</span>  <span class="comment">/* 디렉터리 여부 확인 */</span></div>
<div class="line"><span class="lineno"> 1052</span>  <span class="keywordflow">if</span> ((from_parent_inode.mode &amp; S_IFDIR) == 0 ||</div>
<div class="line"><span class="lineno"> 1053</span>      (to_parent_inode.mode &amp; S_IFDIR) == 0) {</div>
<div class="line"><span class="lineno"> 1054</span>    free(from_copy);</div>
<div class="line"><span class="lineno"> 1055</span>    free(to_copy);</div>
<div class="line"><span class="lineno"> 1056</span>    <span class="keywordflow">return</span> -ENOTDIR;</div>
<div class="line"><span class="lineno"> 1057</span>  }</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>  uint8_t buf_block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno"> 1060</span>  <span class="comment">/* 원본 부모 디렉터리에서 엔트리 제거 */</span></div>
<div class="line"><span class="lineno"> 1061</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 12U; ++i) {</div>
<div class="line"><span class="lineno"> 1062</span>    <span class="keywordflow">if</span> (from_parent_inode.direct[i] == 0)</div>
<div class="line"><span class="lineno"> 1063</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1064</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, from_parent_inode.direct[i], buf_block);</div>
<div class="line"><span class="lineno"> 1065</span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)buf_block;</div>
<div class="line"><span class="lineno"> 1066</span>    <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno"> 1067</span>      <span class="keywordflow">if</span> (entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> == src_ino &amp;&amp;</div>
<div class="line"><span class="lineno"> 1068</span>          strncmp(entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, from_name, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a>) == 0) {</div>
<div class="line"><span class="lineno"> 1069</span>        entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = 0;</div>
<div class="line"><span class="lineno"> 1070</span>        entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1071</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, from_parent_inode.direct[i], entries);</div>
<div class="line"><span class="lineno"> 1072</span>        <span class="keywordflow">goto</span> removed_src;</div>
<div class="line"><span class="lineno"> 1073</span>      }</div>
<div class="line"><span class="lineno"> 1074</span>    }</div>
<div class="line"><span class="lineno"> 1075</span>  }</div>
<div class="line"><span class="lineno"> 1076</span>removed_src:</div>
<div class="line"><span class="lineno"> 1077</span> </div>
<div class="line"><span class="lineno"> 1078</span>  <span class="comment">/* 대상 부모 디렉터리에 엔트리 추가 */</span></div>
<div class="line"><span class="lineno"> 1079</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 12U; ++i) {</div>
<div class="line"><span class="lineno"> 1080</span>    <span class="keywordflow">if</span> (to_parent_inode.direct[i] == 0) {</div>
<div class="line"><span class="lineno"> 1081</span>      <span class="keywordtype">int</span> new_blk = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno"> 1082</span>      <span class="keywordflow">if</span> (new_blk &lt; 0)</div>
<div class="line"><span class="lineno"> 1083</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1084</span>      to_parent_inode.direct[i] = new_blk;</div>
<div class="line"><span class="lineno"> 1085</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)buf_block;</div>
<div class="line"><span class="lineno"> 1086</span>      memset(entries, 0, <span class="keyword">sizeof</span>(buf_block));</div>
<div class="line"><span class="lineno"> 1087</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = src_ino;</div>
<div class="line"><span class="lineno"> 1088</span>      strncpy(entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, to_name, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno"> 1089</span>      entries[0].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>[<a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1090</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, to_parent_inode.direct[i], entries);</div>
<div class="line"><span class="lineno"> 1091</span>      to_parent_inode.size += <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>;</div>
<div class="line"><span class="lineno"> 1092</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1093</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1094</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, to_parent_inode.direct[i], buf_block);</div>
<div class="line"><span class="lineno"> 1095</span>      <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)buf_block;</div>
<div class="line"><span class="lineno"> 1096</span>      <span class="keywordflow">for</span> (uint32_t k = 0; k &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++k) {</div>
<div class="line"><span class="lineno"> 1097</span>        <span class="keywordflow">if</span> (entries[k].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> == 0) {</div>
<div class="line"><span class="lineno"> 1098</span>          entries[k].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> = src_ino;</div>
<div class="line"><span class="lineno"> 1099</span>          strncpy(entries[k].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, to_name, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a> - 1);</div>
<div class="line"><span class="lineno"> 1100</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, to_parent_inode.direct[i], entries);</div>
<div class="line"><span class="lineno"> 1101</span>          <span class="keywordflow">goto</span> added_dst;</div>
<div class="line"><span class="lineno"> 1102</span>        }</div>
<div class="line"><span class="lineno"> 1103</span>      }</div>
<div class="line"><span class="lineno"> 1104</span>    }</div>
<div class="line"><span class="lineno"> 1105</span>  }</div>
<div class="line"><span class="lineno"> 1106</span>added_dst:</div>
<div class="line"><span class="lineno"> 1107</span> </div>
<div class="line"><span class="lineno"> 1108</span>  <span class="comment">/* 메타데이터 갱신 */</span></div>
<div class="line"><span class="lineno"> 1109</span>  time_t now_time = time(NULL);</div>
<div class="line"><span class="lineno"> 1110</span>  from_parent_inode.mtime = from_parent_inode.ctime = (uint32_t)now_time;</div>
<div class="line"><span class="lineno"> 1111</span>  to_parent_inode.mtime = to_parent_inode.ctime = (uint32_t)now_time;</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> src_inode;</div>
<div class="line"><span class="lineno"> 1114</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, src_ino, &amp;src_inode);</div>
<div class="line"><span class="lineno"> 1115</span>  src_inode.ctime = (uint32_t)now_time;</div>
<div class="line"><span class="lineno"> 1116</span> </div>
<div class="line"><span class="lineno"> 1117</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, src_ino, &amp;src_inode);</div>
<div class="line"><span class="lineno"> 1118</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, from_parent_ino, &amp;from_parent_inode);</div>
<div class="line"><span class="lineno"> 1119</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, to_parent_ino, &amp;to_parent_inode);</div>
<div class="line"><span class="lineno"> 1120</span> </div>
<div class="line"><span class="lineno"> 1121</span>  free(from_copy);</div>
<div class="line"><span class="lineno"> 1122</span>  free(to_copy);</div>
<div class="line"><span class="lineno"> 1123</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1124</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_af677d22449626003a22868b28501f79a_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_cgraph" id="ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_cgraph">
<area shape="rect" title="파일 또는 디렉터리 이름 변경 (이동)" alt="" coords="5,133,96,161"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a7342a6b6280af158749416ff1fffadfc" title="슈퍼블록 기반으로 데이터 블록 할당" alt="" coords="159,5,253,33"/>
<area shape="poly" title=" " alt="" coords="61,131,95,93,142,50,160,39,163,43,145,55,99,97,65,135"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="144,159,268,186"/>
<area shape="poly" title=" " alt="" coords="96,152,129,157,128,162,96,157"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="458,160,551,188"/>
<area shape="poly" title=" " alt="" coords="72,159,105,179,144,195,218,210,276,212,335,206,410,195,442,189,443,194,411,200,336,211,276,217,217,215,143,200,103,184,70,164"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="458,108,551,136"/>
<area shape="poly" title=" " alt="" coords="96,142,443,123,443,128,96,147"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="316,57,410,85"/>
<area shape="poly" title=" " alt="" coords="76,130,107,115,143,101,224,82,300,73,301,78,225,87,144,106,109,119,78,135"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="158,260,254,288"/>
<area shape="poly" title=" " alt="" coords="65,160,99,198,145,240,161,250,158,254,142,244,95,202,61,163"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad195af185232b43149a1d9442e28d077" title="비트맵에서 0인 비트를 찾아 1로 설정하고 인덱스를 반환" alt="" coords="325,5,401,33"/>
<area shape="poly" title=" " alt="" coords="254,16,310,16,310,22,254,22"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="318,159,408,186"/>
<area shape="poly" title=" " alt="" coords="268,170,303,170,303,175,268,175"/>
<area shape="poly" title=" " alt="" coords="408,170,443,171,443,176,408,176"/>
<area shape="poly" title=" " alt="" coords="403,156,449,139,450,144,405,161"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="599,109,701,137"/>
<area shape="poly" title=" " alt="" coords="545,157,593,140,595,145,547,162"/>
<area shape="poly" title=" " alt="" coords="411,73,551,94,587,102,585,107,550,99,410,78"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_af677d22449626003a22868b28501f79a_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_icgraph" id="ad2/d5a/fs_8c_af677d22449626003a22868b28501f79a_icgraph">
<area shape="rect" title="파일 또는 디렉터리 이름 변경 (이동)" alt="" coords="499,5,590,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6886feb1b5bf1626b5b4ed7f14169edb" title="이름 변경 콜백" alt="" coords="316,5,451,33"/>
<area shape="poly" title=" " alt="" coords="483,22,452,22,452,16,483,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="301,22,268,22,268,16,301,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a8d5826ede78fcd2b76628eabb56e70db" name="a8d5826ede78fcd2b76628eabb56e70db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d5826ede78fcd2b76628eabb56e70db">&#9670;&#160;</a></span>fs_resolve_path()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_resolve_path </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>out_ino</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>경로 문자열을 inode 번호로 변환 </p>
<p>경로를 inode 번호로 변환</p>
<p>루트("/")는 inode 1로 처리하며, 경로를 '/' 구분자로 분할하여 순차 검색</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>변환할 경로 문자열 (null-terminated) </td></tr>
    <tr><td class="paramname">out_ino</td><td>변환된 inode 번호를 저장할 포인터 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00198">198</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  198</span>                                                                              {</div>
<div class="line"><span class="lineno">  199</span>  <span class="keywordflow">if</span> (strcmp(path, <span class="stringliteral">&quot;/&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  200</span>    *out_ino = 1; <span class="comment">/* 루트 inode */</span></div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  202</span>  }</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>  <span class="comment">/* 경로 복사 및 분할 */</span></div>
<div class="line"><span class="lineno">  205</span>  <span class="keywordtype">char</span> *path_copy = strdup(path);</div>
<div class="line"><span class="lineno">  206</span>  <span class="keywordflow">if</span> (!path_copy)</div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno">  208</span> </div>
<div class="line"><span class="lineno">  209</span>  uint32_t current = 1; <span class="comment">/* 루트부터 시작 */</span></div>
<div class="line"><span class="lineno">  210</span>  <span class="keywordtype">char</span> *token = strtok(path_copy, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  211</span>  <span class="keywordflow">while</span> (token) {</div>
<div class="line"><span class="lineno">  212</span>    uint32_t next;</div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordtype">int</span> ret = <a class="code hl_function" href="../../df/d9c/dir_8h.html#acd690811815cf7e33fb3ab6f8b95216e">dir_lookup</a>(fs, current, token, &amp;next);</div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">if</span> (ret &lt; 0) {</div>
<div class="line"><span class="lineno">  215</span>      free(path_copy);</div>
<div class="line"><span class="lineno">  216</span>      <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  217</span>    }</div>
<div class="line"><span class="lineno">  218</span>    current = next;</div>
<div class="line"><span class="lineno">  219</span>    token = strtok(NULL, <span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  220</span>  }</div>
<div class="line"><span class="lineno">  221</span>  free(path_copy);</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>  *out_ino = current;</div>
<div class="line"><span class="lineno">  224</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  225</span>}</div>
<div class="ttc" id="adir_8h_html_acd690811815cf7e33fb3ab6f8b95216e"><div class="ttname"><a href="../../df/d9c/dir_8h.html#acd690811815cf7e33fb3ab6f8b95216e">dir_lookup</a></div><div class="ttdeci">int dir_lookup(const struct sfuse_fs *fs, uint32_t dir_ino, const char *name, uint32_t *out_ino)</div><div class="ttdoc">디렉터리에서 이름으로 inode 번호를 검색</div><div class="ttdef"><b>Definition</b> <a href="../../de/d32/dir_8c_source.html#l00018">dir.c:18</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_cgraph" id="ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_cgraph">
<area shape="rect" title="경로 문자열을 inode 번호로 변환" alt="" coords="5,32,130,60"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="178,32,267,60"/>
<area shape="poly" title=" " alt="" coords="130,43,162,43,162,48,130,48"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="315,5,407,33"/>
<area shape="poly" title=" " alt="" coords="267,35,299,28,300,34,268,40"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="315,57,407,85"/>
<area shape="poly" title=" " alt="" coords="268,51,300,57,299,63,267,57"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="455,5,558,33"/>
<area shape="poly" title=" " alt="" coords="408,16,440,16,440,22,408,22"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_icgraph" id="ad2/d5a/fs_8c_a8d5826ede78fcd2b76628eabb56e70db_icgraph">
<area shape="rect" title="경로 문자열을 inode 번호로 변환" alt="" coords="831,317,955,345"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#ae8816ea1bc016bed838b45345615d46c" title="접근 권한 검사" alt="" coords="694,5,778,33"/>
<area shape="poly" title=" " alt="" coords="885,303,874,250,854,183,823,112,804,78,781,48,767,36,770,31,785,44,808,76,828,110,859,182,879,249,890,301"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a6129288ed91728ed7ef053ad8d0cc79d" title="파일 생성" alt="" coords="696,57,777,85"/>
<area shape="poly" title=" " alt="" coords="882,303,868,260,847,206,818,150,781,100,766,88,770,83,785,96,823,148,852,204,873,258,887,301"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a012d00e6eafc0bb7c9402e3f36cee00a" title="파일/디렉터리 속성 조회" alt="" coords="694,109,778,137"/>
<area shape="poly" title=" " alt="" coords="878,304,840,230,813,189,781,152,765,140,769,135,785,148,817,186,845,228,883,302"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a0e6c18058ed432a1b33962e1f7fda11f" title="디렉터리 생성" alt="" coords="697,161,776,189"/>
<area shape="poly" title=" " alt="" coords="872,306,833,256,781,204,764,192,767,187,785,200,837,253,876,303"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a9741976c80c2167280c9a0c3ff856d2d" title="파일 열기" alt="" coords="700,213,772,241"/>
<area shape="poly" title=" " alt="" coords="859,310,782,256,761,244,764,239,784,252,862,305"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a28b88e33bc2ea2e1f024968f35073824" title="파일 읽기" alt="" coords="702,265,771,293"/>
<area shape="poly" title=" " alt="" coords="834,314,771,293,772,288,835,309"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#addbb0f0d2e2d634975c40330e23bc8ae" title="디렉터리 내용 읽기" alt="" coords="693,317,780,345"/>
<area shape="poly" title=" " alt="" coords="815,334,780,334,780,328,815,328"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#af677d22449626003a22868b28501f79a" title="파일 또는 디렉터리 이름 변경" alt="" coords="691,369,782,397"/>
<area shape="poly" title=" " alt="" coords="836,353,781,371,780,366,834,348"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8cf3ec78e9108f22f73ac3ab974fe8dc" title="디렉터리 삭제" alt="" coords="535,419,610,446"/>
<area shape="poly" title=" " alt="" coords="868,357,830,386,784,411,739,424,692,432,611,436,611,431,691,427,737,419,782,406,827,382,864,353"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a6a7f3ad04cc17f3fb58519236a2ee996" title="파일 크기 조정 (truncate)" alt="" coords="525,523,620,550"/>
<area shape="poly" title=" " alt="" coords="886,361,872,396,851,438,822,479,784,512,744,531,701,541,658,545,620,544,620,539,658,539,700,536,742,526,782,508,818,475,846,435,867,394,881,359"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#add11b7953b7d14deb0456e14c8d7b197" title="파일 삭제" alt="" coords="696,471,776,498"/>
<area shape="poly" title=" " alt="" coords="873,359,834,405,785,455,762,472,758,468,781,450,830,401,869,356"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a818f99fae8ad5abcc450d41aac5d37ec" title="파일의 시간 속성 변경 (utimens)" alt="" coords="690,625,783,653"/>
<area shape="poly" title=" " alt="" coords="889,361,878,412,858,478,827,548,808,582,785,613,769,627,765,623,781,609,803,579,822,546,852,476,873,411,884,360"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#aecadaa463253df28c47f4a201dda2359" title="파일 쓰기" alt="" coords="700,572,773,600"/>
<area shape="poly" title=" " alt="" coords="885,361,849,453,820,506,785,556,764,574,761,570,781,552,816,503,844,450,880,359"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acf365c5992fb91ebb3982a04fbbdf3b4" title="access 콜백" alt="" coords="321,5,450,33"/>
<area shape="poly" title=" " alt="" coords="679,22,451,22,451,16,679,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,316,268,344"/>
<area shape="poly" title=" " alt="" coords="323,44,318,48,289,80,265,117,228,195,205,266,194,316,189,315,200,265,223,193,260,114,285,77,314,44,319,39"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,316,60,344"/>
<area shape="poly" title=" " alt="" coords="92,332,60,332,60,327,92,327"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6dc52b86f2cef1906558a324213cac6e" title="파일 생성 콜백" alt="" coords="322,57,449,85"/>
<area shape="poly" title=" " alt="" coords="680,74,449,74,449,68,680,68"/>
<area shape="poly" title=" " alt="" coords="324,95,318,100,293,125,270,154,234,217,210,275,196,316,191,315,205,273,230,214,266,151,289,122,314,96,320,91"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6c01c3409d41549c5ca34b9a2f64ccfe" title="파일/디렉터리 속성 조회 콜백" alt="" coords="321,109,450,137"/>
<area shape="poly" title=" " alt="" coords="679,126,451,126,451,120,679,120"/>
<area shape="poly" title=" " alt="" coords="325,147,318,152,276,193,241,239,215,283,198,317,193,314,210,281,237,236,272,189,314,148,322,142"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acac9f9c69134190f86e015e89e39d43f" title="디렉터리 생성 콜백" alt="" coords="324,161,447,189"/>
<area shape="poly" title=" " alt="" coords="682,178,447,178,447,172,682,172"/>
<area shape="poly" title=" " alt="" coords="327,199,317,204,281,232,249,263,202,317,198,314,245,259,278,228,315,200,324,194"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a62bb834f4955786318b1c8588cbb0135" title="파일 열기 콜백" alt="" coords="327,213,444,241"/>
<area shape="poly" title=" " alt="" coords="685,230,445,230,445,224,685,224"/>
<area shape="poly" title=" " alt="" coords="331,250,317,256,259,288,212,318,209,313,257,283,315,251,329,245"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a4e8379279e62363763d8c7da873361d7" title="파일 읽기 콜백" alt="" coords="328,265,443,293"/>
<area shape="poly" title=" " alt="" coords="686,282,443,282,443,276,686,276"/>
<area shape="poly" title=" " alt="" coords="315,300,245,318,244,313,314,295"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acdaffbb59b5fe7d0ceda916714ddc3ad" title="디렉터리 목록 조회 콜백" alt="" coords="507,315,638,342"/>
<area shape="poly" title=" " alt="" coords="678,333,638,332,638,327,678,328"/>
<area shape="poly" title=" " alt="" coords="491,331,269,332,269,327,491,326"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a6886feb1b5bf1626b5b4ed7f14169edb" title="이름 변경 콜백" alt="" coords="505,367,640,394"/>
<area shape="poly" title=" " alt="" coords="675,385,640,384,641,379,676,380"/>
<area shape="poly" title=" " alt="" coords="489,372,268,343,269,338,489,367"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acf89b7cf9e32fbd2b7c749abb1b89234" title="디렉터리 삭제 콜백" alt="" coords="326,417,446,445"/>
<area shape="poly" title=" " alt="" coords="519,435,446,434,446,429,519,429"/>
<area shape="poly" title=" " alt="" coords="338,413,315,402,213,346,215,342,317,397,340,408"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a042aaedab092b188556e193b25a81e9f" title="파일 크기 변경 콜백" alt="" coords="316,521,455,549"/>
<area shape="poly" title=" " alt="" coords="509,539,456,538,456,533,509,533"/>
<area shape="poly" title=" " alt="" coords="332,516,314,504,274,463,239,419,194,345,199,343,243,416,278,460,318,500,335,511"/>
<area shape="poly" title=" " alt="" coords="681,470,610,447,611,442,682,465"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#aad351f0b0a44bc288b2400fd405cef8c" title="파일 삭제 콜백" alt="" coords="510,471,635,498"/>
<area shape="poly" title=" " alt="" coords="680,487,635,487,635,482,680,482"/>
<area shape="poly" title=" " alt="" coords="494,492,406,485,359,475,315,459,276,434,242,402,196,346,200,342,246,399,279,430,317,454,361,470,407,480,494,486"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7e84e199a67a156f1c4f3b9a85d46ad9" title="파일/디렉터리 타임스탬프 갱신 콜백" alt="" coords="503,627,642,654"/>
<area shape="poly" title=" " alt="" coords="674,642,642,643,642,637,674,637"/>
<area shape="poly" title=" " alt="" coords="487,650,445,649,399,642,355,628,314,605,283,577,257,542,236,505,220,467,198,395,188,345,194,344,203,394,225,465,241,503,262,539,287,573,318,601,357,623,400,637,445,643,488,645"/>
<area shape="poly" title=" " alt="" coords="684,573,619,553,621,548,686,568"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#aad4c968c1ab3a4b7e7c8b36054266f59" title="파일 쓰기 콜백" alt="" coords="513,575,632,602"/>
<area shape="poly" title=" " alt="" coords="684,589,632,590,632,585,684,584"/>
<area shape="poly" title=" " alt="" coords="498,600,454,601,406,596,358,584,315,563,286,539,262,511,242,481,225,449,202,388,190,344,195,343,207,387,230,446,246,478,266,508,290,536,317,558,360,579,407,591,454,595,498,595"/>
</map>
</div>

</div>
</div>
<a id="a8cf3ec78e9108f22f73ac3ab974fe8dc" name="a8cf3ec78e9108f22f73ac3ab974fe8dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cf3ec78e9108f22f73ac3ab974fe8dc">&#9670;&#160;</a></span>fs_rmdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_rmdir </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>비어 있는 디렉터리 삭제 </p>
<p>디렉터리 삭제</p>
<p>지정된 경로의 디렉터리가 비어 있는지 확인한 후, fs_unlink 로직을 재사용하여 디렉터리를 제거한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>삭제할 디렉터리 경로 (null-terminated 문자열) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00963">963</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  963</span>                                                    {</div>
<div class="line"><span class="lineno">  964</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  965</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0) {</div>
<div class="line"><span class="lineno">  966</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  967</span>  }</div>
<div class="line"><span class="lineno">  968</span> </div>
<div class="line"><span class="lineno">  969</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno">  970</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode);</div>
<div class="line"><span class="lineno">  971</span>  <span class="comment">/* 디렉터리인지 확인 */</span></div>
<div class="line"><span class="lineno">  972</span>  <span class="keywordflow">if</span> ((inode.mode &amp; S_IFDIR) == 0) {</div>
<div class="line"><span class="lineno">  973</span>    <span class="keywordflow">return</span> -ENOTDIR;</div>
<div class="line"><span class="lineno">  974</span>  }</div>
<div class="line"><span class="lineno">  975</span> </div>
<div class="line"><span class="lineno">  976</span>  <span class="comment">/* 비어 있는지 확인 */</span></div>
<div class="line"><span class="lineno">  977</span>  uint8_t block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  978</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 12; ++i) {</div>
<div class="line"><span class="lineno">  979</span>    <span class="keywordflow">if</span> (inode.direct[i] == 0)</div>
<div class="line"><span class="lineno">  980</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  981</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.direct[i], block) &lt; 0)</div>
<div class="line"><span class="lineno">  982</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  983</span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)block;</div>
<div class="line"><span class="lineno">  984</span>    <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno">  985</span>      <span class="keywordflow">if</span> (entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> != 0) {</div>
<div class="line"><span class="lineno">  986</span>        <span class="keywordflow">return</span> -ENOTEMPTY;</div>
<div class="line"><span class="lineno">  987</span>      }</div>
<div class="line"><span class="lineno">  988</span>    }</div>
<div class="line"><span class="lineno">  989</span>  }</div>
<div class="line"><span class="lineno">  990</span> </div>
<div class="line"><span class="lineno">  991</span>  <span class="comment">/* fs_unlink 로직 재사용 */</span></div>
<div class="line"><span class="lineno">  992</span>  <span class="keywordtype">char</span> *dummy_path = strdup(path);</div>
<div class="line"><span class="lineno">  993</span>  <span class="keywordflow">if</span> (!dummy_path)</div>
<div class="line"><span class="lineno">  994</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno">  995</span>  <span class="keywordtype">int</span> res = <a class="code hl_function" href="#add11b7953b7d14deb0456e14c8d7b197">fs_unlink</a>(fs, path);</div>
<div class="line"><span class="lineno">  996</span>  free(dummy_path);</div>
<div class="line"><span class="lineno">  997</span>  <span class="keywordflow">return</span> res;</div>
<div class="line"><span class="lineno">  998</span>}</div>
<div class="ttc" id="afs_8c_html_add11b7953b7d14deb0456e14c8d7b197"><div class="ttname"><a href="#add11b7953b7d14deb0456e14c8d7b197">fs_unlink</a></div><div class="ttdeci">int fs_unlink(struct sfuse_fs *fs, const char *path)</div><div class="ttdoc">파일 삭제</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d5a/fs_8c_source.html#l00829">fs.c:829</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_cgraph" id="ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_cgraph">
<area shape="rect" title="비어 있는 디렉터리 삭제" alt="" coords="5,265,81,292"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="257,341,381,368"/>
<area shape="poly" title=" " alt="" coords="82,286,252,333,250,338,81,291"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="572,34,664,62"/>
<area shape="poly" title=" " alt="" coords="51,263,79,219,125,160,185,98,219,70,256,47,325,16,356,8,385,4,447,6,524,17,564,26,563,31,523,22,447,12,386,9,357,13,327,21,258,51,222,74,188,102,129,163,83,222,55,266"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="572,341,664,368"/>
<area shape="poly" title=" " alt="" coords="66,290,147,337,201,361,258,377,332,389,390,391,449,387,523,377,558,370,559,375,524,382,449,392,390,397,331,394,256,382,199,366,145,342,63,295"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#add11b7953b7d14deb0456e14c8d7b197" title="파일 삭제" alt="" coords="129,214,209,242"/>
<area shape="poly" title=" " alt="" coords="78,261,118,245,120,250,80,266"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="432,341,521,368"/>
<area shape="poly" title=" " alt="" coords="382,352,416,352,416,357,382,357"/>
<area shape="poly" title=" " alt="" coords="482,339,601,75,606,77,487,341"/>
<area shape="poly" title=" " alt="" coords="522,352,556,352,556,357,522,357"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="712,59,814,87"/>
<area shape="poly" title=" " alt="" coords="665,53,697,59,696,64,664,58"/>
<area shape="poly" title=" " alt="" coords="183,240,215,279,259,320,274,330,271,335,255,324,211,282,179,244"/>
<area shape="poly" title=" " alt="" coords="172,212,182,185,200,151,224,116,255,88,292,69,331,54,413,38,491,34,557,37,557,43,491,40,413,44,333,60,294,74,259,93,228,120,204,154,187,187,177,214"/>
<area shape="poly" title=" " alt="" coords="192,240,222,259,258,276,330,298,389,307,449,313,524,326,557,335,556,340,523,332,448,318,388,312,329,303,256,281,220,263,189,244"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad78edd18fe67d2ffa13fbc1fc89436c0" title="슈퍼블록 기반으로 데이터 블록 해제" alt="" coords="274,135,364,163"/>
<area shape="poly" title=" " alt="" coords="191,211,256,173,268,167,270,172,258,178,194,215"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a156ed842116a648997c737d182b7416a" title="슈퍼블록 기반으로 아이노드 해제" alt="" coords="274,187,364,215"/>
<area shape="poly" title=" " alt="" coords="209,218,258,209,259,214,210,223"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="429,85,524,112"/>
<area shape="poly" title=" " alt="" coords="175,212,205,166,228,141,256,121,295,105,336,96,414,91,414,96,337,101,296,110,258,126,232,145,210,169,180,215"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="271,239,367,267"/>
<area shape="poly" title=" " alt="" coords="210,232,256,240,255,245,209,237"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a9d97a51ca0096c6fe7bf18c3947d2abb" title="비트맵에서 지정한 인덱스 비트를 0으로 설정" alt="" coords="441,162,512,190"/>
<area shape="poly" title=" " alt="" coords="365,154,426,164,425,170,364,159"/>
<area shape="poly" title=" " alt="" coords="364,191,425,181,426,186,365,196"/>
<area shape="poly" title=" " alt="" coords="524,92,697,76,697,81,524,97"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_icgraph" id="ad2/d5a/fs_8c_a8cf3ec78e9108f22f73ac3ab974fe8dc_icgraph">
<area shape="rect" title="비어 있는 디렉터리 삭제" alt="" coords="484,5,560,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acf89b7cf9e32fbd2b7c749abb1b89234" title="디렉터리 삭제 콜백" alt="" coords="316,5,436,33"/>
<area shape="poly" title=" " alt="" coords="469,22,436,22,436,16,469,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,269,22,269,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a2bc3c75472b51af52b6e3bf1e4f17667" name="a2bc3c75472b51af52b6e3bf1e4f17667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bc3c75472b51af52b6e3bf1e4f17667">&#9670;&#160;</a></span>fs_teardown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fs_teardown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 시스템 해제 </p>
<p>파일 시스템 정리</p>
<p>슈퍼블록과 비트맵을 디스크에 동기화하고, 할당된 메모리 및 파일 디스크립터 정리</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>해제할 파일 시스템 컨텍스트 포인터 </td></tr>
  </table>
  </dd>
</dl>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00165">165</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  165</span>                                      {</div>
<div class="line"><span class="lineno">  166</span>  <span class="keywordflow">if</span> (!fs)</div>
<div class="line"><span class="lineno">  167</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>  <span class="comment">/* 슈퍼블록 동기화 */</span></div>
<div class="line"><span class="lineno">  170</span>  <a class="code hl_function" href="../../db/d98/super_8h.html#a6ec742f3d4baa9cae3ccba0efeec47dd">sb_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>);</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>  <span class="comment">/* 비트맵 동기화 */</span></div>
<div class="line"><span class="lineno">  173</span>  uint32_t bits_per_block = <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> * 8;</div>
<div class="line"><span class="lineno">  174</span>  uint32_t im_blocks =</div>
<div class="line"><span class="lineno">  175</span>      (fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a0b37cfe3235e397d42dddc21183f688b">total_inodes</a> + bits_per_block - 1) / bits_per_block;</div>
<div class="line"><span class="lineno">  176</span>  uint32_t bm_blocks =</div>
<div class="line"><span class="lineno">  177</span>      (fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#af5c413e0bf39804304cad2b659941dd3">total_blocks</a> + bits_per_block - 1) / bits_per_block;</div>
<div class="line"><span class="lineno">  178</span>  <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a08e26f9ee07d1cd29ae89220513cc50a">bitmap_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#aa9f7184193bd49902350f37506e020f1">inode_bitmap_start</a>, fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>,</div>
<div class="line"><span class="lineno">  179</span>              im_blocks + bm_blocks);</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">/* 메모리 및 파일 디스크립터 정리 */</span></div>
<div class="line"><span class="lineno">  182</span>  free(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a937ca2879e30e603bf5619adf8536ab5">inode_table</a>);</div>
<div class="line"><span class="lineno">  183</span>  free(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>);</div>
<div class="line"><span class="lineno">  184</span>  close(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>);</div>
<div class="line"><span class="lineno">  185</span>  free(fs);</div>
<div class="line"><span class="lineno">  186</span>}</div>
<div class="ttc" id="abitmap_8h_html_a08e26f9ee07d1cd29ae89220513cc50a"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html#a08e26f9ee07d1cd29ae89220513cc50a">bitmap_sync</a></div><div class="ttdeci">int bitmap_sync(int fd, uint32_t start_blk, const struct sfuse_bitmaps *bmaps, uint32_t count)</div><div class="ttdoc">메모리 비트맵을 디스크에 동기화</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9a/bitmap_8c_source.html#l00040">bitmap.c:40</a></div></div>
<div class="ttc" id="astructsfuse__fs_html_a937ca2879e30e603bf5619adf8536ab5"><div class="ttname"><a href="../../df/dc5/structsfuse__fs.html#a937ca2879e30e603bf5619adf8536ab5">sfuse_fs::inode_table</a></div><div class="ttdeci">struct sfuse_inode_block * inode_table</div><div class="ttdef"><b>Definition</b> <a href="../../df/d26/fs_8h_source.html#l00025">fs.h:25</a></div></div>
<div class="ttc" id="asuper_8h_html_a6ec742f3d4baa9cae3ccba0efeec47dd"><div class="ttname"><a href="../../db/d98/super_8h.html#a6ec742f3d4baa9cae3ccba0efeec47dd">sb_sync</a></div><div class="ttdeci">int sb_sync(int fd, const struct sfuse_superblock *sb)</div><div class="ttdoc">슈퍼블록을 디스크에 동기화</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d1d/super_8c_source.html#l00040">super.c:40</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_cgraph" id="ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_cgraph">
<area shape="rect" title="파일 시스템 해제" alt="" coords="5,32,107,60"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a08e26f9ee07d1cd29ae89220513cc50a" title="메모리 비트맵을 디스크에 동기화" alt="" coords="155,5,259,33"/>
<area shape="poly" title=" " alt="" coords="107,34,139,28,140,34,108,40"/>
<area shape="rect" href="../../d2/d1d/super_8c.html#a6ec742f3d4baa9cae3ccba0efeec47dd" title="슈퍼블록을 디스크에 동기화" alt="" coords="170,57,244,85"/>
<area shape="poly" title=" " alt="" coords="108,52,155,60,154,65,107,57"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="307,5,403,33"/>
<area shape="poly" title=" " alt="" coords="260,16,291,16,291,22,260,22"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_icgraph" id="ad2/d5a/fs_8c_a2bc3c75472b51af52b6e3bf1e4f17667_icgraph">
<area shape="rect" title="파일 시스템 해제" alt="" coords="108,5,209,33"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="a6a7f3ad04cc17f3fb58519236a2ee996" name="a6a7f3ad04cc17f3fb58519236a2ee996"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a7f3ad04cc17f3fb58519236a2ee996">&#9670;&#160;</a></span>fs_truncate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_truncate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 크기 조정 </p>
<p>파일 크기 조정 (truncate)</p>
<p>지정된 경로의 파일 크기를 주어진 크기로 변경. 크기 축소 시 불필요한 데이터 블록을 해제하고, 크기 확장 시 필요한 경우 단일 바이트 쓰기를 통해 공간을 확보.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>대상 파일 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">size</td><td>새 파일 크기 (바이트 단위) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 유지할 블록 수</p>
<p>&lt; 기존 블록 수</p>
<p>&lt; 1차 인덱스</p>
<p>&lt; 2차 인덱스</p>
<p>&lt; 파일 크기 갱신</p>
<p>&lt; 수정 시간 갱신</p>
<p>&lt; 변경 시간 갱신</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01138">1138</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1138</span>                                                                   {</div>
<div class="line"><span class="lineno"> 1139</span>  uint32_t ino;</div>
<div class="line"><span class="lineno"> 1140</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1141</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno"> 1142</span>  }</div>
<div class="line"><span class="lineno"> 1143</span> </div>
<div class="line"><span class="lineno"> 1144</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno"> 1145</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode);</div>
<div class="line"><span class="lineno"> 1146</span> </div>
<div class="line"><span class="lineno"> 1147</span>  <span class="comment">/* 디렉터리인 경우 오류 반환 */</span></div>
<div class="line"><span class="lineno"> 1148</span>  <span class="keywordflow">if</span> ((inode.mode &amp; S_IFDIR) == S_IFDIR) {</div>
<div class="line"><span class="lineno"> 1149</span>    <span class="keywordflow">return</span> -EISDIR;</div>
<div class="line"><span class="lineno"> 1150</span>  }</div>
<div class="line"><span class="lineno"> 1151</span> </div>
<div class="line"><span class="lineno"> 1152</span>  off_t old_size = inode.size;</div>
<div class="line"><span class="lineno"> 1153</span>  <span class="comment">/* 변경할 크기가 동일하면 즉시 반환 */</span></div>
<div class="line"><span class="lineno"> 1154</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> == old_size) {</div>
<div class="line"><span class="lineno"> 1155</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1156</span>  }</div>
<div class="line"><span class="lineno"> 1157</span>  <span class="comment">/* 크기 축소 */</span></div>
<div class="line"><span class="lineno"> 1158</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> &lt; old_size) {</div>
<div class="line"><span class="lineno"> 1159</span>    uint32_t keep_blocks =</div>
<div class="line"><span class="lineno"> 1160</span>        (<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> + <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> - 1) / <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno"> 1161</span>    uint32_t old_blocks = (old_size + <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> - 1) /</div>
<div class="line"><span class="lineno"> 1162</span>                          <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno"> 1163</span> </div>
<div class="line"><span class="lineno"> 1164</span>    <span class="comment">/* 축소되어야 할 블록 해제 */</span></div>
<div class="line"><span class="lineno"> 1165</span>    <span class="keywordflow">for</span> (uint32_t i = keep_blocks; i &lt; old_blocks; ++i) {</div>
<div class="line"><span class="lineno"> 1166</span>      <span class="keywordflow">if</span> (i &lt; 12) {</div>
<div class="line"><span class="lineno"> 1167</span>        <span class="keywordflow">if</span> (inode.direct[i] != 0) {</div>
<div class="line"><span class="lineno"> 1168</span>          <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, inode.direct[i]);</div>
<div class="line"><span class="lineno"> 1169</span>          inode.direct[i] = 0;</div>
<div class="line"><span class="lineno"> 1170</span>        }</div>
<div class="line"><span class="lineno"> 1171</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt; 12U + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>) {</div>
<div class="line"><span class="lineno"> 1172</span>        <span class="keywordflow">if</span> (inode.indirect != 0) {</div>
<div class="line"><span class="lineno"> 1173</span>          uint32_t ptrs[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1174</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs);</div>
<div class="line"><span class="lineno"> 1175</span>          <span class="keywordtype">int</span> idx = i - 12;</div>
<div class="line"><span class="lineno"> 1176</span>          <span class="keywordflow">if</span> (ptrs[idx] != 0) {</div>
<div class="line"><span class="lineno"> 1177</span>            <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, ptrs[idx]);</div>
<div class="line"><span class="lineno"> 1178</span>            ptrs[idx] = 0;</div>
<div class="line"><span class="lineno"> 1179</span>          }</div>
<div class="line"><span class="lineno"> 1180</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs);</div>
<div class="line"><span class="lineno"> 1181</span>        }</div>
<div class="line"><span class="lineno"> 1182</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1183</span>        <span class="keywordflow">if</span> (inode.double_indirect != 0) {</div>
<div class="line"><span class="lineno"> 1184</span>          uint32_t level1_arr[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1185</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, level1_arr);</div>
<div class="line"><span class="lineno"> 1186</span>          uint32_t idx = i - (12 + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>);</div>
<div class="line"><span class="lineno"> 1187</span>          uint32_t l1_idx = idx / <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; </div>
<div class="line"><span class="lineno"> 1188</span>          uint32_t l2_idx = idx % <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; </div>
<div class="line"><span class="lineno"> 1189</span> </div>
<div class="line"><span class="lineno"> 1190</span>          <span class="keywordflow">if</span> (level1_arr[l1_idx] != 0) {</div>
<div class="line"><span class="lineno"> 1191</span>            uint32_t level2_arr[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1192</span>            <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, level1_arr[l1_idx], level2_arr);</div>
<div class="line"><span class="lineno"> 1193</span>            <span class="keywordflow">if</span> (level2_arr[l2_idx] != 0) {</div>
<div class="line"><span class="lineno"> 1194</span>              <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, level2_arr[l2_idx]);</div>
<div class="line"><span class="lineno"> 1195</span>              level2_arr[l2_idx] = 0;</div>
<div class="line"><span class="lineno"> 1196</span>            }</div>
<div class="line"><span class="lineno"> 1197</span>            <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, level1_arr[l1_idx], level2_arr);</div>
<div class="line"><span class="lineno"> 1198</span>          }</div>
<div class="line"><span class="lineno"> 1199</span>        }</div>
<div class="line"><span class="lineno"> 1200</span>      }</div>
<div class="line"><span class="lineno"> 1201</span>    }</div>
<div class="line"><span class="lineno"> 1202</span> </div>
<div class="line"><span class="lineno"> 1203</span>    <span class="comment">/* 단일 간접 블록 전체가 비었는지 확인 후 해제 */</span></div>
<div class="line"><span class="lineno"> 1204</span>    <span class="keywordflow">if</span> (inode.indirect != 0) {</div>
<div class="line"><span class="lineno"> 1205</span>      uint32_t ptrs[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1206</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs);</div>
<div class="line"><span class="lineno"> 1207</span>      <span class="keywordtype">int</span> all_empty = 1;</div>
<div class="line"><span class="lineno"> 1208</span>      <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno"> 1209</span>        <span class="keywordflow">if</span> (ptrs[j] != 0) {</div>
<div class="line"><span class="lineno"> 1210</span>          all_empty = 0;</div>
<div class="line"><span class="lineno"> 1211</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1212</span>        }</div>
<div class="line"><span class="lineno"> 1213</span>      }</div>
<div class="line"><span class="lineno"> 1214</span>      <span class="keywordflow">if</span> (all_empty) {</div>
<div class="line"><span class="lineno"> 1215</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, inode.indirect);</div>
<div class="line"><span class="lineno"> 1216</span>        inode.indirect = 0;</div>
<div class="line"><span class="lineno"> 1217</span>      }</div>
<div class="line"><span class="lineno"> 1218</span>    }</div>
<div class="line"><span class="lineno"> 1219</span> </div>
<div class="line"><span class="lineno"> 1220</span>    <span class="comment">/* 이중 간접 블록 전체가 비었는지 확인 후 해제 */</span></div>
<div class="line"><span class="lineno"> 1221</span>    <span class="keywordflow">if</span> (inode.double_indirect != 0) {</div>
<div class="line"><span class="lineno"> 1222</span>      uint32_t level1[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1223</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, level1);</div>
<div class="line"><span class="lineno"> 1224</span>      <span class="keywordtype">int</span> all_l1_empty = 1;</div>
<div class="line"><span class="lineno"> 1225</span>      <span class="keywordflow">for</span> (uint32_t a = 0; a &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++a) {</div>
<div class="line"><span class="lineno"> 1226</span>        <span class="keywordflow">if</span> (level1[a] != 0) {</div>
<div class="line"><span class="lineno"> 1227</span>          uint32_t level2[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno"> 1228</span>          <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, level1[a], level2);</div>
<div class="line"><span class="lineno"> 1229</span>          <span class="keywordtype">int</span> all_l2_empty = 1;</div>
<div class="line"><span class="lineno"> 1230</span>          <span class="keywordflow">for</span> (uint32_t b = 0; b &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++b) {</div>
<div class="line"><span class="lineno"> 1231</span>            <span class="keywordflow">if</span> (level2[b] != 0) {</div>
<div class="line"><span class="lineno"> 1232</span>              all_l2_empty = 0;</div>
<div class="line"><span class="lineno"> 1233</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1234</span>            }</div>
<div class="line"><span class="lineno"> 1235</span>          }</div>
<div class="line"><span class="lineno"> 1236</span>          <span class="keywordflow">if</span> (all_l2_empty) {</div>
<div class="line"><span class="lineno"> 1237</span>            <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, level1[a]);</div>
<div class="line"><span class="lineno"> 1238</span>            level1[a] = 0;</div>
<div class="line"><span class="lineno"> 1239</span>          } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1240</span>            all_l1_empty = 0;</div>
<div class="line"><span class="lineno"> 1241</span>          }</div>
<div class="line"><span class="lineno"> 1242</span>        }</div>
<div class="line"><span class="lineno"> 1243</span>      }</div>
<div class="line"><span class="lineno"> 1244</span>      <span class="keywordflow">if</span> (all_l1_empty) {</div>
<div class="line"><span class="lineno"> 1245</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, inode.double_indirect);</div>
<div class="line"><span class="lineno"> 1246</span>        inode.double_indirect = 0;</div>
<div class="line"><span class="lineno"> 1247</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1248</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, level1);</div>
<div class="line"><span class="lineno"> 1249</span>      }</div>
<div class="line"><span class="lineno"> 1250</span>    }</div>
<div class="line"><span class="lineno"> 1251</span> </div>
<div class="line"><span class="lineno"> 1252</span>    inode.size = <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a>; </div>
<div class="line"><span class="lineno"> 1253</span>  }</div>
<div class="line"><span class="lineno"> 1254</span>  <span class="comment">/* 크기 확장 */</span></div>
<div class="line"><span class="lineno"> 1255</span>  <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1256</span>    <span class="keywordtype">char</span> zero = 0;</div>
<div class="line"><span class="lineno"> 1257</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="#aecadaa463253df28c47f4a201dda2359">fs_write</a>(fs, path, &amp;zero, 1, <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - 1) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1258</span>      <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno"> 1259</span>    }</div>
<div class="line"><span class="lineno"> 1260</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1261</span>  }</div>
<div class="line"><span class="lineno"> 1262</span> </div>
<div class="line"><span class="lineno"> 1263</span>  <span class="comment">/* 시간 정보 갱신 및 동기화 */</span></div>
<div class="line"><span class="lineno"> 1264</span>  time_t now_time = time(NULL);</div>
<div class="line"><span class="lineno"> 1265</span>  inode.mtime = (uint32_t)now_time; </div>
<div class="line"><span class="lineno"> 1266</span>  inode.ctime = (uint32_t)now_time; </div>
<div class="line"><span class="lineno"> 1267</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode);</div>
<div class="line"><span class="lineno"> 1268</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1269</span>}</div>
<div class="ttc" id="abitmap_8h_html_ad78edd18fe67d2ffa13fbc1fc89436c0"><div class="ttname"><a href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a></div><div class="ttdeci">void free_block(struct sfuse_superblock *sb, struct sfuse_block_bitmap *bmap, uint32_t blk)</div><div class="ttdoc">슈퍼블록 기반으로 데이터 블록 해제</div><div class="ttdef"><b>Definition</b> <a href="../../df/d9a/bitmap_8c_source.html#l00135">bitmap.c:135</a></div></div>
<div class="ttc" id="afs_8c_html_aecadaa463253df28c47f4a201dda2359"><div class="ttname"><a href="#aecadaa463253df28c47f4a201dda2359">fs_write</a></div><div class="ttdeci">int fs_write(struct sfuse_fs *fs, const char *path, const char *buf, size_t size, off_t offset)</div><div class="ttdoc">파일 쓰기</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d5a/fs_8c_source.html#l00407">fs.c:407</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_cgraph" id="ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_cgraph">
<area shape="rect" title="파일 크기 조정" alt="" coords="5,235,100,262"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad78edd18fe67d2ffa13fbc1fc89436c0" title="슈퍼블록 기반으로 데이터 블록 해제" alt="" coords="148,7,237,34"/>
<area shape="poly" title=" " alt="" coords="55,233,86,152,112,100,146,51,154,42,158,46,150,54,117,102,91,154,60,235"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="285,311,409,338"/>
<area shape="poly" title=" " alt="" coords="101,259,148,271,275,304,273,309,147,276,99,264"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="595,133,687,161"/>
<area shape="poly" title=" " alt="" coords="86,232,174,196,284,162,370,145,457,138,520,137,579,139,579,144,520,142,457,143,371,150,286,167,176,201,88,236"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="595,311,687,338"/>
<area shape="poly" title=" " alt="" coords="67,261,101,300,149,341,214,379,245,390,285,399,328,405,372,404,416,399,458,391,535,368,596,343,598,348,537,373,459,396,416,405,372,410,328,410,285,404,243,395,211,384,146,345,98,304,63,264"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#aecadaa463253df28c47f4a201dda2359" title="파일 쓰기" alt="" coords="156,235,229,262"/>
<area shape="poly" title=" " alt="" coords="100,246,140,246,140,251,100,251"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="300,57,394,85"/>
<area shape="poly" title=" " alt="" coords="56,233,68,204,86,168,112,131,146,101,179,84,215,74,284,66,285,71,216,79,181,89,149,105,116,135,91,171,72,207,61,235"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="299,363,395,390"/>
<area shape="poly" title=" " alt="" coords="78,261,149,299,221,330,289,355,287,360,219,335,147,304,76,265"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a9d97a51ca0096c6fe7bf18c3947d2abb" title="비트맵에서 지정한 인덱스 비트를 0으로 설정" alt="" coords="312,5,383,33"/>
<area shape="poly" title=" " alt="" coords="237,17,296,17,296,22,237,23"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="457,311,547,338"/>
<area shape="poly" title=" " alt="" coords="410,322,441,322,441,327,410,327"/>
<area shape="poly" title=" " alt="" coords="512,309,617,172,621,175,516,312"/>
<area shape="poly" title=" " alt="" coords="547,322,579,322,579,327,547,327"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="735,83,837,110"/>
<area shape="poly" title=" " alt="" coords="682,130,729,113,731,118,684,135"/>
<area shape="poly" title=" " alt="" coords="224,261,305,301,302,306,221,265"/>
<area shape="poly" title=" " alt="" coords="213,232,246,212,284,195,362,174,442,160,579,146,579,152,443,165,363,179,286,200,248,217,216,236"/>
<area shape="poly" title=" " alt="" coords="230,250,369,267,547,297,580,304,579,310,546,302,369,272,229,255"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a7342a6b6280af158749416ff1fffadfc" title="슈퍼블록 기반으로 데이터 블록 할당" alt="" coords="300,209,394,237"/>
<area shape="poly" title=" " alt="" coords="229,240,284,231,285,236,230,245"/>
<area shape="poly" title=" " alt="" coords="204,233,322,95,326,99,208,236"/>
<area shape="poly" title=" " alt="" coords="205,261,239,303,261,327,287,348,295,353,292,357,283,352,258,331,235,307,201,264"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad195af185232b43149a1d9442e28d077" title="비트맵에서 0인 비트를 찾아 1로 설정하고 인덱스를 반환" alt="" coords="464,209,540,237"/>
<area shape="poly" title=" " alt="" coords="395,220,448,220,448,226,395,226"/>
<area shape="poly" title=" " alt="" coords="395,71,719,90,719,95,395,77"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_icgraph" id="ad2/d5a/fs_8c_a6a7f3ad04cc17f3fb58519236a2ee996_icgraph">
<area shape="rect" title="파일 크기 조정" alt="" coords="503,5,598,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a042aaedab092b188556e193b25a81e9f" title="파일 크기 변경 콜백" alt="" coords="316,5,455,33"/>
<area shape="poly" title=" " alt="" coords="487,22,456,22,456,16,487,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,268,22,268,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="add11b7953b7d14deb0456e14c8d7b197" name="add11b7953b7d14deb0456e14c8d7b197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add11b7953b7d14deb0456e14c8d7b197">&#9670;&#160;</a></span>fs_unlink()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_unlink </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 삭제 </p>
<p>지정된 경로의 파일을 삭제하고, 관련 데이터 블록 및 아이노드를 해제한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>삭제할 파일 경로 (null-terminated 문자열) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 파일/디렉터리 이름의 최대 길이</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00829">829</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  829</span>                                                     {</div>
<div class="line"><span class="lineno">  830</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  831</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0) {</div>
<div class="line"><span class="lineno">  832</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  833</span>  }</div>
<div class="line"><span class="lineno">  834</span> </div>
<div class="line"><span class="lineno">  835</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno">  836</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode);</div>
<div class="line"><span class="lineno">  837</span>  <span class="comment">/* 디렉터리는 삭제 불가 */</span></div>
<div class="line"><span class="lineno">  838</span>  <span class="keywordflow">if</span> ((inode.mode &amp; S_IFDIR) == S_IFDIR) {</div>
<div class="line"><span class="lineno">  839</span>    <span class="keywordflow">return</span> -EISDIR;</div>
<div class="line"><span class="lineno">  840</span>  }</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>  <span class="comment">/* 상위 디렉터리 및 파일 이름 분리 */</span></div>
<div class="line"><span class="lineno">  843</span>  <span class="keywordtype">char</span> *path_copy = strdup(path);</div>
<div class="line"><span class="lineno">  844</span>  <span class="keywordflow">if</span> (!path_copy)</div>
<div class="line"><span class="lineno">  845</span>    <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"><span class="lineno">  846</span>  <span class="keywordtype">char</span> *name = strrchr(path_copy, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  847</span>  *name = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  848</span>  <span class="keywordtype">char</span> *parent_path = (*path_copy == <span class="charliteral">&#39;\0&#39;</span>) ? <span class="stringliteral">&quot;/&quot;</span> : path_copy;</div>
<div class="line"><span class="lineno">  849</span>  name++;</div>
<div class="line"><span class="lineno">  850</span> </div>
<div class="line"><span class="lineno">  851</span>  <span class="comment">/* 상위 디렉터리 inode 조회 */</span></div>
<div class="line"><span class="lineno">  852</span>  uint32_t parent_ino;</div>
<div class="line"><span class="lineno">  853</span>  <a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, parent_path, &amp;parent_ino);</div>
<div class="line"><span class="lineno">  854</span> </div>
<div class="line"><span class="lineno">  855</span>  uint8_t dir_block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  856</span>  uint8_t zero_block[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>] = {0}; <span class="comment">/* 블록 초기화용 제로 버퍼 */</span></div>
<div class="line"><span class="lineno">  857</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> parent_inode;</div>
<div class="line"><span class="lineno">  858</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  859</span> </div>
<div class="line"><span class="lineno">  860</span>  <span class="comment">/* 상위 디렉터리에서 디렉터리 엔트리 제거 */</span></div>
<div class="line"><span class="lineno">  861</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 12; ++i) {</div>
<div class="line"><span class="lineno">  862</span>    <span class="keywordflow">if</span> (parent_inode.direct[i] == 0)</div>
<div class="line"><span class="lineno">  863</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  864</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block) &lt; 0)</div>
<div class="line"><span class="lineno">  865</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  866</span>    <span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *entries = (<span class="keyword">struct </span><a class="code hl_struct" href="../../d8/d1a/structsfuse__dirent.html">sfuse_dirent</a> *)dir_block;</div>
<div class="line"><span class="lineno">  867</span>    <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; <a class="code hl_define" href="../../df/d9c/dir_8h.html#aea073931da657513026982c1aac99b4d">DENTS_PER_BLOCK</a>; ++j) {</div>
<div class="line"><span class="lineno">  868</span>      <span class="keywordflow">if</span> (entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a> == ino &amp;&amp;</div>
<div class="line"><span class="lineno">  869</span>          strncmp(entries[j].<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a9b38e50447844882ddaaacb947f3d5dc">name</a>, <a class="code hl_define" href="../../df/d9c/dir_8h.html#a309b8658c2817a5c55a08445e9760743">SFUSE_NAME_MAX</a>) == 0) {</div>
<div class="line"><span class="lineno">  870</span>        <span class="comment">/* 삭제 시 디렉터리 엔트리 전체를 0으로 초기화 */</span></div>
<div class="line"><span class="lineno">  871</span>        memset(&amp;entries[j], 0, <span class="keyword">sizeof</span>(entries[j]));</div>
<div class="line"><span class="lineno">  872</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, parent_inode.direct[i], dir_block);</div>
<div class="line"><span class="lineno">  873</span>        <span class="keywordflow">goto</span> found_entry;</div>
<div class="line"><span class="lineno">  874</span>      }</div>
<div class="line"><span class="lineno">  875</span>    }</div>
<div class="line"><span class="lineno">  876</span>  }</div>
<div class="line"><span class="lineno">  877</span>found_entry:</div>
<div class="line"><span class="lineno">  878</span> </div>
<div class="line"><span class="lineno">  879</span>  <span class="comment">/* 직접 데이터 블록 해제: 내용 제로화 후 상대 인덱스로 비트맵 해제 */</span></div>
<div class="line"><span class="lineno">  880</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 12; ++i) {</div>
<div class="line"><span class="lineno">  881</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.direct[i] == 0)</div>
<div class="line"><span class="lineno">  882</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  883</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.direct[i],</div>
<div class="line"><span class="lineno">  884</span>                zero_block); <span class="comment">// 블록 내용 모두 0으로 덮어쓰기</span></div>
<div class="line"><span class="lineno">  885</span>    <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>,</div>
<div class="line"><span class="lineno">  886</span>               <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.direct[i] -</div>
<div class="line"><span class="lineno">  887</span>                   fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>); <span class="comment">// 상대 블록 번호로 비트맵 해제</span></div>
<div class="line"><span class="lineno">  888</span>    <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.direct[i] = 0;</div>
<div class="line"><span class="lineno">  889</span>  }</div>
<div class="line"><span class="lineno">  890</span> </div>
<div class="line"><span class="lineno">  891</span>  <span class="comment">/* 단일 간접 블록 해제: 데이터 블록과 포인터 블록 모두 제로화 후 해제 */</span></div>
<div class="line"><span class="lineno">  892</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.indirect != 0) {</div>
<div class="line"><span class="lineno">  893</span>    uint32_t ptrs[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  894</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.indirect, ptrs);</div>
<div class="line"><span class="lineno">  895</span>    <span class="keywordflow">for</span> (uint32_t k = 0; k &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++k) {</div>
<div class="line"><span class="lineno">  896</span>      <span class="keywordflow">if</span> (ptrs[k] == 0)</div>
<div class="line"><span class="lineno">  897</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  898</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, ptrs[k], zero_block);</div>
<div class="line"><span class="lineno">  899</span>      <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, ptrs[k] - fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>);</div>
<div class="line"><span class="lineno">  900</span>      ptrs[k] = 0;</div>
<div class="line"><span class="lineno">  901</span>    }</div>
<div class="line"><span class="lineno">  902</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.indirect,</div>
<div class="line"><span class="lineno">  903</span>                zero_block); <span class="comment">// 포인터 블록도 제로화</span></div>
<div class="line"><span class="lineno">  904</span>    <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>,</div>
<div class="line"><span class="lineno">  905</span>               <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.indirect - fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>);</div>
<div class="line"><span class="lineno">  906</span>    <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.indirect = 0;</div>
<div class="line"><span class="lineno">  907</span>  }</div>
<div class="line"><span class="lineno">  908</span> </div>
<div class="line"><span class="lineno">  909</span>  <span class="comment">/* 이중 간접 블록 해제: 이중 레벨 순회하며 제로화 후 해제 */</span></div>
<div class="line"><span class="lineno">  910</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.double_indirect != 0) {</div>
<div class="line"><span class="lineno">  911</span>    uint32_t l1[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  912</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.double_indirect, l1);</div>
<div class="line"><span class="lineno">  913</span>    <span class="keywordflow">for</span> (uint32_t i1 = 0; i1 &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++i1) {</div>
<div class="line"><span class="lineno">  914</span>      <span class="keywordflow">if</span> (l1[i1] == 0)</div>
<div class="line"><span class="lineno">  915</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  916</span>      uint32_t l2[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  917</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[i1], l2);</div>
<div class="line"><span class="lineno">  918</span>      <span class="keywordflow">for</span> (uint32_t i2 = 0; i2 &lt; <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; ++i2) {</div>
<div class="line"><span class="lineno">  919</span>        <span class="keywordflow">if</span> (l2[i2] == 0)</div>
<div class="line"><span class="lineno">  920</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  921</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l2[i2], zero_block);</div>
<div class="line"><span class="lineno">  922</span>        <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>,</div>
<div class="line"><span class="lineno">  923</span>                   l2[i2] - fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>);</div>
<div class="line"><span class="lineno">  924</span>        l2[i2] = 0;</div>
<div class="line"><span class="lineno">  925</span>      }</div>
<div class="line"><span class="lineno">  926</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[i1], zero_block); <span class="comment">// 2차 포인터 블록 제로화</span></div>
<div class="line"><span class="lineno">  927</span>      <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>, l1[i1] - fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>);</div>
<div class="line"><span class="lineno">  928</span>      l1[i1] = 0;</div>
<div class="line"><span class="lineno">  929</span>    }</div>
<div class="line"><span class="lineno">  930</span>    <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.double_indirect,</div>
<div class="line"><span class="lineno">  931</span>                zero_block); <span class="comment">// 1차 포인터 블록 제로화</span></div>
<div class="line"><span class="lineno">  932</span>    <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#ad78edd18fe67d2ffa13fbc1fc89436c0">free_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>,</div>
<div class="line"><span class="lineno">  933</span>               <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.double_indirect - fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a>);</div>
<div class="line"><span class="lineno">  934</span>    <a class="code hl_variable" href="../../d8/d1a/structsfuse__dirent.html#a73e74a2f27bfdd1383b6292beff30476">inode</a>.double_indirect = 0;</div>
<div class="line"><span class="lineno">  935</span>  }</div>
<div class="line"><span class="lineno">  936</span> </div>
<div class="line"><span class="lineno">  937</span>  <span class="comment">/* 아이노드 비트맵 해제 및 아이노드 초기화 */</span></div>
<div class="line"><span class="lineno">  938</span>  <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a156ed842116a648997c737d182b7416a">free_inode</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#ae875a8ba6b9ca19192fc23bef93c8adf">inode</a>, ino);</div>
<div class="line"><span class="lineno">  939</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> empty_inode;</div>
<div class="line"><span class="lineno">  940</span>  memset(&amp;empty_inode, 0, <span class="keyword">sizeof</span>(empty_inode));</div>
<div class="line"><span class="lineno">  941</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;empty_inode);</div>
<div class="line"><span class="lineno">  942</span> </div>
<div class="line"><span class="lineno">  943</span>  <span class="comment">/* 상위 디렉터리 메타데이터 갱신 */</span></div>
<div class="line"><span class="lineno">  944</span>  time_t now_time = time(NULL);</div>
<div class="line"><span class="lineno">  945</span>  parent_inode.mtime = (uint32_t)now_time;</div>
<div class="line"><span class="lineno">  946</span>  parent_inode.ctime = (uint32_t)now_time;</div>
<div class="line"><span class="lineno">  947</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, parent_ino, &amp;parent_inode);</div>
<div class="line"><span class="lineno">  948</span> </div>
<div class="line"><span class="lineno">  949</span>  free(path_copy);</div>
<div class="line"><span class="lineno">  950</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  951</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_cgraph" id="ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_cgraph">
<area shape="rect" title="파일 삭제" alt="" coords="5,159,86,186"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad78edd18fe67d2ffa13fbc1fc89436c0" title="슈퍼블록 기반으로 데이터 블록 해제" alt="" coords="151,57,240,85"/>
<area shape="poly" title=" " alt="" coords="61,156,132,101,150,90,153,95,135,105,64,160"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a156ed842116a648997c737d182b7416a" title="슈퍼블록 기반으로 아이노드 해제" alt="" coords="151,5,241,33"/>
<area shape="poly" title=" " alt="" coords="51,157,81,103,104,72,132,44,139,39,142,43,135,48,108,75,86,106,56,159"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="134,209,258,237"/>
<area shape="poly" title=" " alt="" coords="87,183,139,201,137,206,85,188"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="448,211,541,238"/>
<area shape="poly" title=" " alt="" coords="59,185,90,218,111,234,135,246,173,257,213,264,294,265,370,255,434,240,435,246,371,260,294,270,212,269,172,262,133,251,108,238,87,222,55,188"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="448,159,541,186"/>
<area shape="poly" title=" " alt="" coords="86,170,433,170,433,175,86,175"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="306,108,400,136"/>
<area shape="poly" title=" " alt="" coords="86,161,133,151,291,127,291,132,134,156,87,166"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="148,311,244,338"/>
<area shape="poly" title=" " alt="" coords="56,185,87,235,110,264,135,290,149,300,146,305,132,295,106,268,83,238,52,188"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a9d97a51ca0096c6fe7bf18c3947d2abb" title="비트맵에서 지정한 인덱스 비트를 0으로 설정" alt="" coords="318,31,389,58"/>
<area shape="poly" title=" " alt="" coords="241,61,302,50,303,56,242,66"/>
<area shape="poly" title=" " alt="" coords="242,24,302,34,301,39,241,29"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="308,209,398,237"/>
<area shape="poly" title=" " alt="" coords="258,220,293,220,293,226,258,226"/>
<area shape="poly" title=" " alt="" coords="398,221,433,221,433,227,398,226"/>
<area shape="poly" title=" " alt="" coords="393,206,439,190,440,195,395,211"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="589,160,691,188"/>
<area shape="poly" title=" " alt="" coords="535,208,583,191,585,196,537,213"/>
<area shape="poly" title=" " alt="" coords="401,124,541,145,577,153,575,158,540,150,400,129"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_icgraph" id="ad2/d5a/fs_8c_add11b7953b7d14deb0456e14c8d7b197_icgraph">
<area shape="rect" title="파일 삭제" alt="" coords="613,32,693,60"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8cf3ec78e9108f22f73ac3ab974fe8dc" title="디렉터리 삭제" alt="" coords="489,7,565,34"/>
<area shape="poly" title=" " alt="" coords="597,37,565,31,566,25,598,32"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#aad351f0b0a44bc288b2400fd405cef8c" title="파일 삭제 콜백" alt="" coords="316,57,441,85"/>
<area shape="poly" title=" " alt="" coords="597,54,442,68,441,63,597,48"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#acf89b7cf9e32fbd2b7c749abb1b89234" title="디렉터리 삭제 콜백" alt="" coords="318,5,439,33"/>
<area shape="poly" title=" " alt="" coords="474,23,439,22,439,17,474,17"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,32,268,60"/>
<area shape="poly" title=" " alt="" coords="304,32,269,37,268,32,303,27"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,32,60,60"/>
<area shape="poly" title=" " alt="" coords="92,48,60,48,60,43,92,43"/>
<area shape="poly" title=" " alt="" coords="301,64,268,59,269,54,301,58"/>
</map>
</div>

</div>
</div>
<a id="a818f99fae8ad5abcc450d41aac5d37ec" name="a818f99fae8ad5abcc450d41aac5d37ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a818f99fae8ad5abcc450d41aac5d37ec">&#9670;&#160;</a></span>fs_utimens()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_utimens </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct timespec</td>          <td class="paramname"><span class="paramname"><em>tv</em></span>[2]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 접근/수정 시간 업데이트 </p>
<p>파일의 시간 속성 변경 (utimens)</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>대상 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">tv</td><td>tv[0]=접근 시간, tv[1]=수정 시간 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>성공 시 0, 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 접근 시간 설정</p>
<p>&lt; 수정 시간 설정</p>
<p>&lt; 메타데이터 변경 시간 갱신</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l01318">1318</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1319</span>                                            {</div>
<div class="line"><span class="lineno"> 1320</span>  uint32_t ino;</div>
<div class="line"><span class="lineno"> 1321</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1322</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno"> 1323</span>  }</div>
<div class="line"><span class="lineno"> 1324</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno"> 1325</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode) &lt; 0) {</div>
<div class="line"><span class="lineno"> 1326</span>    <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno"> 1327</span>  }</div>
<div class="line"><span class="lineno"> 1328</span>  inode.<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a4ec8882c06d3f0935c3af6d551aee955">atime</a> = (uint32_t)tv[0].tv_sec; </div>
<div class="line"><span class="lineno"> 1329</span>  inode.mtime = (uint32_t)tv[1].tv_sec; </div>
<div class="line"><span class="lineno"> 1330</span>  inode.ctime = (uint32_t)time(NULL);   </div>
<div class="line"><span class="lineno"> 1331</span>  <a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode);</div>
<div class="line"><span class="lineno"> 1332</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1333</span>}</div>
<div class="ttc" id="astructsfuse__inode_html_a4ec8882c06d3f0935c3af6d551aee955"><div class="ttname"><a href="../../d2/d13/structsfuse__inode.html#a4ec8882c06d3f0935c3af6d551aee955">sfuse_inode::atime</a></div><div class="ttdeci">uint32_t atime</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d73/inode_8h_source.html#l00027">inode.h:27</a></div></div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_cgraph" id="ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_cgraph">
<area shape="rect" title="파일 접근/수정 시간 업데이트" alt="" coords="5,57,99,85"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="147,7,271,34"/>
<area shape="poly" title=" " alt="" coords="96,54,149,37,150,42,98,59"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="461,57,554,85"/>
<area shape="poly" title=" " alt="" coords="99,68,446,68,446,74,99,74"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="319,108,413,136"/>
<area shape="poly" title=" " alt="" coords="100,78,147,87,304,111,304,116,146,92,99,83"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="322,7,411,34"/>
<area shape="poly" title=" " alt="" coords="271,18,306,18,306,23,271,23"/>
<area shape="poly" title=" " alt="" coords="408,32,453,49,452,54,406,37"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="461,5,554,33"/>
<area shape="poly" title=" " alt="" coords="411,17,446,17,446,22,411,23"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="602,83,704,110"/>
<area shape="poly" title=" " alt="" coords="554,77,587,82,586,88,554,82"/>
<area shape="poly" title=" " alt="" coords="414,115,586,100,587,105,414,120"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_icgraph" id="ad2/d5a/fs_8c_a818f99fae8ad5abcc450d41aac5d37ec_icgraph">
<area shape="rect" title="파일 접근/수정 시간 업데이트" alt="" coords="502,5,596,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7e84e199a67a156f1c4f3b9a85d46ad9" title="파일/디렉터리 타임스탬프 갱신 콜백" alt="" coords="316,5,454,33"/>
<area shape="poly" title=" " alt="" coords="487,22,455,22,455,16,487,16"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,5,268,33"/>
<area shape="poly" title=" " alt="" coords="300,22,269,22,269,16,300,16"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,5,60,33"/>
<area shape="poly" title=" " alt="" coords="92,22,60,22,60,16,92,16"/>
</map>
</div>

</div>
</div>
<a id="aecadaa463253df28c47f4a201dda2359" name="aecadaa463253df28c47f4a201dda2359"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aecadaa463253df28c47f4a201dda2359">&#9670;&#160;</a></span>fs_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fs_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dc5/structsfuse__fs.html">sfuse_fs</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t</td>          <td class="paramname"><span class="paramname"><em>offset</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>파일 쓰기 </p>
<p>지정된 경로의 파일에 사용자 버퍼의 데이터를 기록한다.</p>
<dl class="params"><dt>매개변수</dt><dd>
  <table class="params">
    <tr><td class="paramname">fs</td><td>파일 시스템 컨텍스트 포인터 </td></tr>
    <tr><td class="paramname">path</td><td>쓰기 대상 파일 경로 (null-terminated 문자열) </td></tr>
    <tr><td class="paramname">buf</td><td>기록할 데이터가 담긴 버퍼 포인터 </td></tr>
    <tr><td class="paramname">size</td><td>기록할 바이트 수 </td></tr>
    <tr><td class="paramname">offset</td><td>파일 내 시작 오프셋 (바이트 단위) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>반환값</dt><dd>기록된 바이트 수 (&gt;=0), 실패 시 음수 오류 코드 </dd></dl>
<p>&lt; 현재 오프셋</p>
<p>&lt; 논리 블록 인덱스</p>
<p>&lt; 블록 내 오프셋</p>
<p>&lt; 블록 경계까지 쓸 바이트</p>
<p>&lt; 대상 블록 포인터 위치</p>
<p>&lt; 실제 할당된 디스크 블록 번호</p>
<p>&lt; 1차 인덱스</p>
<p>&lt; 2차 인덱스</p>
<p>&lt; 수정 시간 갱신</p>
<p>&lt; 변경 시간 갱신</p>

<p class="definition"><a class="el" href="../../d2/d5a/fs_8c_source.html">fs.c</a> 파일의 <a class="el" href="../../d2/d5a/fs_8c_source.html#l00407">407</a> 번째 라인에서 정의되었습니다.</p>
<div class="fragment"><div class="line"><span class="lineno">  408</span>                                        {</div>
<div class="line"><span class="lineno">  409</span>  uint32_t ino;</div>
<div class="line"><span class="lineno">  410</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="#a8d5826ede78fcd2b76628eabb56e70db">fs_resolve_path</a>(fs, path, &amp;ino) &lt; 0)</div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">return</span> -ENOENT;</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../d2/d13/structsfuse__inode.html">sfuse_inode</a> inode;</div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#a490b41738be882c224282cb0873c4185">inode_load</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode) &lt; 0)</div>
<div class="line"><span class="lineno">  415</span>    <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>  <span class="comment">/*&lt; 디렉터리에는 쓰기 불가 */</span></div>
<div class="line"><span class="lineno">  418</span>  <span class="keywordflow">if</span> ((inode.mode &amp; S_IFDIR) == S_IFDIR)</div>
<div class="line"><span class="lineno">  419</span>    <span class="keywordflow">return</span> -EISDIR;</div>
<div class="line"><span class="lineno">  420</span> </div>
<div class="line"><span class="lineno">  421</span>  <span class="keywordtype">size_t</span> bytes_written = 0;</div>
<div class="line"><span class="lineno">  422</span>  uint8_t block_buf[<a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>];</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>  <span class="comment">/*&lt; 요청한 크기만큼 반복 처리 */</span></div>
<div class="line"><span class="lineno">  425</span>  <span class="keywordflow">while</span> (bytes_written &lt; <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a>) {</div>
<div class="line"><span class="lineno">  426</span>    off_t cur_offset = offset + bytes_written; </div>
<div class="line"><span class="lineno">  427</span>    uint32_t block_index =</div>
<div class="line"><span class="lineno">  428</span>        cur_offset / <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno">  429</span>    uint32_t block_offset =</div>
<div class="line"><span class="lineno">  430</span>        cur_offset % <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a>; </div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordtype">size_t</span> to_write =</div>
<div class="line"><span class="lineno">  432</span>        <a class="code hl_define" href="../../db/d98/super_8h.html#a0f31825083a6f1e0e2f5b5a2fd1181aa">SFUSE_BLOCK_SIZE</a> - block_offset; </div>
<div class="line"><span class="lineno">  433</span>    <span class="keywordflow">if</span> (to_write &gt; <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - bytes_written)</div>
<div class="line"><span class="lineno">  434</span>      to_write = <a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> - bytes_written;</div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>    uint32_t *target = NULL; </div>
<div class="line"><span class="lineno">  437</span>    uint32_t disk_block = 0; </div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>    <span class="comment">/*&lt; 직접 블록 */</span></div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">if</span> (block_index &lt; 12U) {</div>
<div class="line"><span class="lineno">  441</span>      target = &amp;inode.direct[block_index];</div>
<div class="line"><span class="lineno">  442</span>      disk_block = *target; <span class="comment">/* direct 블록 포인터로 disk_block 초기화 */</span></div>
<div class="line"><span class="lineno">  443</span>    }</div>
<div class="line"><span class="lineno">  444</span>    <span class="comment">/*&lt; 단일 간접 블록 */</span></div>
<div class="line"><span class="lineno">  445</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (block_index &lt; 12U + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>) {</div>
<div class="line"><span class="lineno">  446</span>      <span class="keywordflow">if</span> (inode.indirect == 0) {</div>
<div class="line"><span class="lineno">  447</span>        <span class="comment">/* 간접 블록이 없으면 새 할당 */</span></div>
<div class="line"><span class="lineno">  448</span>        <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  449</span>        <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  450</span>          <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  451</span>        inode.indirect =</div>
<div class="line"><span class="lineno">  452</span>            (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  453</span>                       new_block); <span class="comment">/* 간접 블록 주소도 절대 번호로 변환 */</span></div>
<div class="line"><span class="lineno">  454</span>        uint32_t tmp[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>] = {0};</div>
<div class="line"><span class="lineno">  455</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, tmp);</div>
<div class="line"><span class="lineno">  456</span>      }</div>
<div class="line"><span class="lineno">  457</span>      <span class="comment">/* 기존 간접 블록에서 포인터 읽기 */</span></div>
<div class="line"><span class="lineno">  458</span>      uint32_t ptrs[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  459</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>      target = &amp;ptrs[block_index - 12U];</div>
<div class="line"><span class="lineno">  462</span>      disk_block = *target;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>      <span class="comment">/* 새 데이터 블록 할당 */</span></div>
<div class="line"><span class="lineno">  465</span>      <span class="keywordflow">if</span> (disk_block == 0) {</div>
<div class="line"><span class="lineno">  466</span>        <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  467</span>        <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  468</span>          <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  469</span>        disk_block = (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  470</span>                                new_block); <span class="comment">/* 새 블록 인덱스를 데이터 영역</span></div>
<div class="line"><span class="lineno">  471</span><span class="comment">                                               오프셋과 합산 */</span></div>
<div class="line"><span class="lineno">  472</span>        *target = disk_block;</div>
<div class="line"><span class="lineno">  473</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.indirect, ptrs);</div>
<div class="line"><span class="lineno">  474</span>      }</div>
<div class="line"><span class="lineno">  475</span>    }</div>
<div class="line"><span class="lineno">  476</span>    <span class="comment">/*&lt; 이중 간접 블록 */</span></div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  478</span>      uint32_t dbl_index = block_index - (12U + <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>);</div>
<div class="line"><span class="lineno">  479</span>      uint32_t l1_idx = dbl_index / <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; </div>
<div class="line"><span class="lineno">  480</span>      uint32_t l2_idx = dbl_index % <a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>; </div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span>      <span class="keywordflow">if</span> (inode.double_indirect == 0) {</div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  484</span>        <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  485</span>          <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  486</span>        inode.double_indirect =</div>
<div class="line"><span class="lineno">  487</span>            (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  488</span>                       new_block); <span class="comment">/* 이중 간접 블록도 절대 번호로 변환 */</span></div>
<div class="line"><span class="lineno">  489</span>        uint32_t tmp[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>] = {0};</div>
<div class="line"><span class="lineno">  490</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, tmp);</div>
<div class="line"><span class="lineno">  491</span>      }</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>      uint32_t l1[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  494</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, l1);</div>
<div class="line"><span class="lineno">  495</span> </div>
<div class="line"><span class="lineno">  496</span>      <span class="keywordflow">if</span> (l1[l1_idx] == 0) {</div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  498</span>        <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  499</span>          <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  500</span>        l1[l1_idx] = (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  501</span>                                new_block); <span class="comment">/* 레벨1 인덱스에도 데이터 영역 시작</span></div>
<div class="line"><span class="lineno">  502</span><span class="comment">                                               오프셋 적용 */</span></div>
<div class="line"><span class="lineno">  503</span>        uint32_t tmp[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>] = {0};</div>
<div class="line"><span class="lineno">  504</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[l1_idx], tmp);</div>
<div class="line"><span class="lineno">  505</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, inode.double_indirect, l1);</div>
<div class="line"><span class="lineno">  506</span>      }</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>      uint32_t l2[<a class="code hl_define" href="../../d3/d73/inode_8h.html#a113396e915a4441e2d49df4b7bb6d26c">SFUSE_PTRS_PER_BLOCK</a>];</div>
<div class="line"><span class="lineno">  509</span>      <a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[l1_idx], l2);</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>      <span class="keywordflow">if</span> (l2[l2_idx] == 0) {</div>
<div class="line"><span class="lineno">  512</span>        <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  513</span>        <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  514</span>          <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  515</span>        l2[l2_idx] = (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  516</span>                                new_block); <span class="comment">/* 레벨2 인덱스에도 오프셋을 더해</span></div>
<div class="line"><span class="lineno">  517</span><span class="comment">                                               절대 주소로 */</span></div>
<div class="line"><span class="lineno">  518</span>        <a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, l1[l1_idx], l2);</div>
<div class="line"><span class="lineno">  519</span>      }</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>      disk_block = l2[l2_idx];</div>
<div class="line"><span class="lineno">  522</span>      target = &amp;l2[l2_idx];</div>
<div class="line"><span class="lineno">  523</span>    }</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>    <span class="comment">/*&lt; 아직 할당되지 않았으면 새로 할당 */</span></div>
<div class="line"><span class="lineno">  526</span>    <span class="keywordflow">if</span> (target &amp;&amp; *target == 0) {</div>
<div class="line"><span class="lineno">  527</span>      <span class="keywordtype">int</span> new_block = <a class="code hl_function" href="../../da/dcb/bitmap_8h.html#a7342a6b6280af158749416ff1fffadfc">alloc_block</a>(&amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a188eaee1b599d1c0260a905a1c27c73d">bmaps</a>-&gt;<a class="code hl_variable" href="../../d2/d35/structsfuse__bitmaps.html#a9b626055d1a1c2f76698bd9723f0110f">block</a>);</div>
<div class="line"><span class="lineno">  528</span>      <span class="keywordflow">if</span> (new_block &lt; 0)</div>
<div class="line"><span class="lineno">  529</span>        <span class="keywordflow">return</span> -ENOSPC;</div>
<div class="line"><span class="lineno">  530</span>      *target = (uint32_t)(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>.<a class="code hl_variable" href="../../d7/d75/structsfuse__superblock.html#a85add9a4b064a3a048d7580e1ecd9a85">data_block_start</a> +</div>
<div class="line"><span class="lineno">  531</span>                           new_block); <span class="comment">/* 상대 인덱스에 데이터 영역 시작 블록</span></div>
<div class="line"><span class="lineno">  532</span><span class="comment">                                          번호 더해 절대 블록 번호로 저장 */</span></div>
<div class="line"><span class="lineno">  533</span>      disk_block = *target;</div>
<div class="line"><span class="lineno">  534</span>    }</div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>    <span class="comment">/*&lt; 기존 블록 읽기 */</span></div>
<div class="line"><span class="lineno">  537</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#a737beb05c598c11278e8b17146b48dcf">read_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, disk_block, block_buf) &lt; 0)</div>
<div class="line"><span class="lineno">  538</span>      <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>    <span class="comment">/*&lt; 데이터 쓰기 */</span></div>
<div class="line"><span class="lineno">  541</span>    memcpy(block_buf + block_offset, buf + bytes_written, to_write);</div>
<div class="line"><span class="lineno">  542</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../de/d40/block_8h.html#af4beb38783113f42a845b7702ebaa8d5">write_block</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, disk_block, block_buf) &lt; 0)</div>
<div class="line"><span class="lineno">  543</span>      <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>    bytes_written += to_write;</div>
<div class="line"><span class="lineno">  546</span>  }</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>  <span class="comment">/*&lt; 파일 크기 갱신 */</span></div>
<div class="line"><span class="lineno">  549</span>  <span class="keywordflow">if</span> ((uint32_t)(offset + bytes_written) &gt; inode.size)</div>
<div class="line"><span class="lineno">  550</span>    inode.<a class="code hl_variable" href="../../d2/d13/structsfuse__inode.html#a8f67762b0e63a291da0db528b627922c">size</a> = offset + bytes_written;</div>
<div class="line"><span class="lineno">  551</span>  inode.mtime = time(NULL);  </div>
<div class="line"><span class="lineno">  552</span>  inode.ctime = inode.mtime; </div>
<div class="line"><span class="lineno">  553</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d73/inode_8h.html#abbb03a523d329cec86d9473e1a6ff70b">inode_sync</a>(fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#af14cab3f6994b0e91e858ddffc424140">backing_fd</a>, &amp;fs-&gt;<a class="code hl_variable" href="../../df/dc5/structsfuse__fs.html#a86cd2ebfda2408f59d3260897c1a4866">sb</a>, ino, &amp;inode) &lt; 0)</div>
<div class="line"><span class="lineno">  554</span>    <span class="keywordflow">return</span> -EIO;</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>  <span class="keywordflow">return</span> bytes_written;</div>
<div class="line"><span class="lineno">  557</span>}</div>
</div><!-- fragment --><div class="dynheader">
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_cgraph.png" border="0" usemap="#ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_cgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_cgraph" id="ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_cgraph">
<area shape="rect" title="파일 쓰기" alt="" coords="5,133,79,161"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#a7342a6b6280af158749416ff1fffadfc" title="슈퍼블록 기반으로 데이터 블록 할당" alt="" coords="142,5,236,33"/>
<area shape="poly" title=" " alt="" coords="51,131,82,93,125,50,142,39,145,43,128,55,86,96,55,135"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a8d5826ede78fcd2b76628eabb56e70db" title="경로 문자열을 inode 번호로 변환" alt="" coords="127,159,251,186"/>
<area shape="poly" title=" " alt="" coords="79,151,112,157,111,162,79,156"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#a490b41738be882c224282cb0873c4185" title="디스크 이미지에서 아이노드를 읽어 구조체에 로드" alt="" coords="441,160,534,188"/>
<area shape="poly" title=" " alt="" coords="62,159,91,179,127,195,200,211,259,213,318,206,393,195,425,189,426,194,394,200,318,211,259,218,200,216,126,200,89,184,59,164"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#a737beb05c598c11278e8b17146b48dcf" title="지정한 블록 번호의 데이터를 읽어 버퍼에 저장" alt="" coords="441,108,534,136"/>
<area shape="poly" title=" " alt="" coords="79,142,426,123,426,128,79,148"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#abbb03a523d329cec86d9473e1a6ff70b" title="아이노드 구조체 내용을 디스크 이미지에 동기화" alt="" coords="299,57,393,85"/>
<area shape="poly" title=" " alt="" coords="64,131,93,115,126,101,207,81,283,72,284,77,208,87,127,106,95,119,67,135"/>
<area shape="rect" href="../../d3/d1c/block_8c.html#af4beb38783113f42a845b7702ebaa8d5" title="버퍼의 내용을 지정한 블록 번호에 기록" alt="" coords="141,260,237,288"/>
<area shape="poly" title=" " alt="" coords="55,160,86,198,128,240,143,250,140,254,125,244,82,202,51,163"/>
<area shape="rect" href="../../df/d9a/bitmap_8c.html#ad195af185232b43149a1d9442e28d077" title="비트맵에서 0인 비트를 찾아 1로 설정하고 인덱스를 반환" alt="" coords="308,5,384,33"/>
<area shape="poly" title=" " alt="" coords="237,16,293,16,293,22,237,22"/>
<area shape="rect" href="../../de/d32/dir_8c.html#acd690811815cf7e33fb3ab6f8b95216e" title="디렉터리에서 이름으로 inode 번호를 검색" alt="" coords="302,159,391,186"/>
<area shape="poly" title=" " alt="" coords="251,170,286,170,286,175,251,175"/>
<area shape="poly" title=" " alt="" coords="391,170,426,171,426,176,391,176"/>
<area shape="poly" title=" " alt="" coords="386,156,432,139,433,144,388,161"/>
<area shape="rect" href="../../d8/d2b/inode_8c.html#ae003f96dd0c540bc9f2fc169274f1d6f" title="아이노드 테이블 내 특정 아이노드의 디스크 내 바이트 오프셋을 계산" alt="" coords="582,109,684,137"/>
<area shape="poly" title=" " alt="" coords="528,157,576,140,578,145,530,162"/>
<area shape="poly" title=" " alt="" coords="394,73,534,94,570,102,568,107,533,99,393,78"/>
</map>
</div>
<div class="dynheader">
이 함수를 호출하는 함수들에 대한 그래프입니다.:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_icgraph.png" border="0" usemap="#ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_icgraph" loading="lazy" alt=""/></div>
<map name="ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_icgraph" id="ad2/d5a/fs_8c_aecadaa463253df28c47f4a201dda2359_icgraph">
<area shape="rect" title="파일 쓰기" alt="" coords="646,32,719,60"/>
<area shape="rect" href="../../d2/d5a/fs_8c.html#a6a7f3ad04cc17f3fb58519236a2ee996" title="파일 크기 조정 (truncate)" alt="" coords="503,7,598,34"/>
<area shape="poly" title=" " alt="" coords="630,38,598,32,599,27,631,33"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#aad4c968c1ab3a4b7e7c8b36054266f59" title="파일 쓰기 콜백" alt="" coords="326,57,445,85"/>
<area shape="poly" title=" " alt="" coords="631,53,446,69,445,63,630,48"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a042aaedab092b188556e193b25a81e9f" title="파일 크기 변경 콜백" alt="" coords="316,5,455,33"/>
<area shape="poly" title=" " alt="" coords="487,23,456,22,456,17,487,17"/>
<area shape="rect" href="../../d9/d70/ops_8c.html#a7f093e2e9259d0b6002f4da685de854d" title="SFUSE용 FUSE operations 구조체 반환" alt="" coords="108,32,268,60"/>
<area shape="poly" title=" " alt="" coords="301,33,269,38,268,32,300,28"/>
<area shape="rect" href="../../d0/d29/main_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="프로그램 진입점" alt="" coords="5,32,60,60"/>
<area shape="poly" title=" " alt="" coords="92,48,60,48,60,43,92,43"/>
<area shape="poly" title=" " alt="" coords="311,64,268,59,269,54,312,59"/>
</map>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">변수 문서화</h2>
<a id="a0771760ee8a223b01c598e70420cef0c" name="a0771760ee8a223b01c598e70420cef0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0771760ee8a223b01c598e70420cef0c">&#9670;&#160;</a></span>g_force_format</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool g_force_format</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>전역: 포맷 강제 여부 (-F 옵션) </p>
<p>전역: 포맷 강제 여부 (-F 옵션)</p>
<p>강제 포맷 옵션 플래그</p>
<p>이 플래그는 main.c에서 정의되며, FS 초기화 시 포맷을 강제할 때 사용됩니다.</p>
<p>&lt; fs_initialize, fs_teardown, g_force_format extern </p>
<p>main.c에서 정의되며, fs_initialize에서 VSFS 포맷을 강제할 때 사용됩니다. </p>

<p class="definition"><a class="el" href="../../d0/d29/main_8c_source.html">main.c</a> 파일의 <a class="el" href="../../d0/d29/main_8c_source.html#l00032">32</a> 번째 라인에서 정의되었습니다.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="../../d2/d5a/fs_8c.html">fs.c</a></li>
    <li class="footer">다음에 의해 생성됨 :  <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
